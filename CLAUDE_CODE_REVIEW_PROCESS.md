# AIコードレビュープロセス

## 目的

AIがコードでミスをした場合、 systematic に検出、記録、修正、検証するプロセスを確立する。

## ミスの記録

### 過去のミス

#### 1. 日干「己」の十大主星テーブルが完全に間違っていた
- **ファイル**: `accurate-logic/src/yangsen.ts`
- **行**: 124
- **問題**: 日干「己」の行がすべて「調舒星」または「禄存星」になっていた
- **原因**: テーブルデータのコピー＆ペーストミス、検証不足
- **修正**: 正しいテーブルデータに書き換え
- **検証**: 涼子（1977-08-20）と2025-01-20で検証

#### 2. 右手・左手の計算ロジックが間違っていた
- **ファイル**: `accurate-logic/src/yangsen.ts`
- **行**: 226-234
- **問題**:
  - 右手: 日干×日支の蔭干（間違い）
  - 左手: 日干×年支の蔭干（間違い）
- **原因**: 陽占の計算ルールの誤解
- **修正**:
  - 右手: 日干「乙」×年干（正しい）
  - 左手: 日干「乙」×年支の本気（正しい）
- **検証**: 涼子（1977-08-20）と2025-01-20で検証

#### 3. 腹の計算ロジックが未解決
- **ファイル**: `accurate-logic/src/yangsen.ts`
- **行**: 221-223
- **問題**: 腹の計算結果が「司禄星」になるが、期待値は「石門星」
- **原因**: 不明（追加の検証データが必要）
- **ステータス**: 未解決

## プロセスの確立

### 1. ミスの検出

- **朱学院との比較**: 定期的に朱学院のデータと比較して、不一致を検出
- **複数の日付で検証**: 1つの日付だけでなく、複数の日付でパターンを検証
- **自動テスト**: 検証データを使用した自動テストを実装

### 2. ミスの記録

- **ドキュメント化**: `claudedocs/` 以下に分析ドキュメントを作成
- **テンプレート**: 以下の情報を記録
  - ファイル名と行番号
  - 問題の説明
  - 原因
  - 修正内容
  - 検証結果

### 3. 修正の実装

- **元のコードを保存**: Git commit で元の状態を保存
- **修正を実装**: 間違ったロジックを修正
- **TypeScriptをコンパイル**: `npx tsc` で dist ファイルを更新
- **検証**: CLI ツールで計算結果を確認

### 4. 検証

- **複数の日付で検証**: 少なくとも3つ以上の日付で検証
- **朱学院と比較**: 正解データと比較して、一致を確認
- **エッジケース**: 異なる日干、異なる月で検証

## 今後の対応

1. **追加の検証データを収集**: 日干「己」以外の日干でも検証
2. **自動テストを実装**: 検証データを使用したテストスイートを作成
3. **ドキュメントを更新**: 正しい計算ロジックをドキュメント化

## テンプレート

### ミス記録テンプレート

```markdown
#### タイトル

- **ファイル**: `path/to/file.ts`
- **行**: XX
- **問題**: 問題の説明
- **原因**: 原因の説明
- **修正**: 修正内容の説明
- **検証**: 検証結果
```

### 検証ドキュメントテンプレート

```markdown
# 検証ドキュメント

## 概要
検証の目的と範囲

## 検証データ
- 日付1: 結果
- 日付2: 結果
- 日付3: 結果

## 結論
検証の結論
```

## まとめ

AIがミスしたコードをレビューするプロセスを確立しました。今後、ミスを発見した場合は、このプロセスに従って systematic に対応します。
