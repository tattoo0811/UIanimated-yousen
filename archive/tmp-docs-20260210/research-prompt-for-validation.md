# 算命学命式計算の検証プロンプト

## 背景

ドクター巡の人生処方箋というプロジェクトで、算命学（四柱推命・陰陽五行）に基づく運命診断システムを開発中です。計算ロジックの正確性を検証する必要があります。

## 実装している計算ロジック

### 1. 四柱推命（BaZi）の計算
- ライブラリ: `lunar-javascript`
- 年柱・月柱・日柱・時柱を干支で計算
- 日柱には1-60のID（六十花甲子の順番）を付与

### 2. 天中殺の計算
```javascript
const group = Math.floor((ganZhiId - 1) / 10);
const types = ['戌亥天中殺', '申酉天中殺', '午未天中殺', '辰巳天中殺', '寅卯天中殺', '子丑天中殺'];
```
- 日柱の六十花甲子ID（1-60）からグループを決定
- 例：日柱ID 40（癸卯）→ group = 3 → 辰巳天中殺

### 3. 十大主星（陽占・人体図）の計算
```javascript
// 五行関係の計算
const rel = (targetElem - dayElem + 5) % 5; // 0:比和, 1:洩気, 2:財, 3:官, 4:印
const polMatch = (dayPolarity === targetPolarity) ? 0 : 1; // 0:同陰陽, 1:異陰陽
const index = rel * 2 + polMatch;

const TEN_STARS = [
    '貫索星', '石門星',  // 0: 比和（同五行）
    '鳳閣星', '調舒星',  // 1: 洩気（我が生ずる）
    '禄存星', '司禄星',  // 2: 財（我を生ずる）
    '車騎星', '牽牛星',  // 3: 官（我を剋する）
    '龍高星', '玉堂星'   // 4: 印（我を剛する）
];
```

人体図の配置：
- **頭**: 日干 × 年干
- **右手**: 日干 × 日支蔵干
- **胸**: 日干 × 月支蔵干
- **左手**: 日干 × 年支蔵干
- **腹**: 日干 × 月干

### 4. 蔵干の計算（二十八元）
節入りからの日数に基づいて蔵干を動的に選択：

```javascript
// 酉の二十八元データ
'酉': { main: { stem: '辛' } }, // 酉は辛のみ

// 申の二十八元データ
'申': {
    extra: { stem: '戊', days: 10 },  // 余気: 節入り後10日間
    sub: { stem: '壬', days: 3 },     // 中気: 次の3日間
    main: { stem: '庚' }              // 本気: 残りの日数
}
```

例：9月14日（白露から7日目）の場合
- 申の蔵干 = 余気（10日）の範囲内 = **戊**
- 酉の蔵干 = **辛**（固定）

## 検証事例

### ケース1: 1995年9月14日 女性
**計算結果**:
- 四柱: 乙亥 / 乙酉 / 戊申 / 戊午
- 日柱ID: 45（戊申）
- 天中殺: **寅卯天中殺** ✓（正しい）

**十大主星（人体図）**:
- 日干: 戊（土・陽）
- 頭: 牽牛星
- 右手: 貫索星
- 胸: **調舒星**
- 左手: 車騎星
- 腹: 牽牛星

**問題点**:
- 胸の計算: 日干（戊・土）× 月支蔵干
- 月支は酉、蔵干は**辛（金）**
- 土 × 金 = **印**の関係
- 印で同陰陽なら「龍高星」、異陰陽なら「玉堂星」になるはず
- **しかし、実際は「調舒星」（洩気）になっている**

調舒星（洩気）になるには、対象が**木**である必要があります。
- つまり、月支（酉）の蔵干が**木（甲または乙）**である必要があります

### ケース2: 1990年5月21日 男性（慧の候補生年月日）
**計算結果**:
- 四柱: 庚午 / 辛巳 / 丙戌 / 甲午
- 日柱ID: 57（丙戌）
- 天中殺: **寅卯天中殺** ✓（正しい）

**十大主星（人体図）**:
- 日干: 丙（火・陽）
- 頭: 禄存星
- 右手: **鳳閣星** ✓
- 左手: 調舒星
- 胸: 貫索星
- 腹: 司禄星

**ユーザー確認値との整合性**:
- 頭: 禄存星 ✓
- 右手: 鳳閣星 ✓
- このケースは正しく計算できている

## 質問事項

### Q1: 陽占の胸の計算について
1995年9月14日のケースで、月支（酉）の蔵干は通常「辛（金）」ですが、胸が「調舒星」になっています。

調舒星になるには、日干（戊・土）に対して**洩気（木）**の関係が必要です。

**質問**:
1. 陽占の胸の計算で、月支（酉）の蔵干が**木（甲または乙）**になることはありますか？
2. ある場合、その条件やルールは何ですか？
3. 二十八元とは異なる蔵干選択方法が存在しますか？

### Q2: 天中殺の計算について
日柱の六十花甲子ID（1-60）から天中殺を計算する方法は正しいですか？

**質問**:
1. 日支ではなく、日柱IDで計算する方法は一般的ですか？
2. 別の流派では、どのように天中殺を計算しますか？

### Q3: 十大主星の計算について
TEN_STARS配列と計算ロジックは正しいですか？

**質問**:
1. 陰陽五行の関係（比和・洩気・財・官・印）の定義は正しいですか？
2. 陰陽の一致・不一致を加えた10星分類は一般的ですか？

### Q4: 十二大従星の計算について
ENERGY_TABLEからエネルギー点数を取得する方法は正しいですか？

**質問**:
1. 別の実装や流派では、どのように十二大従星を計算しますか？
2. エネルギー点数表の値は流派によって異なりますか？

## 参照してほしい情報源

1. 三才占学（九條運命診療所で使用している算命学）の専門書
2. 陰陽道の蔵干についての解説
3. 二十八元についての詳細
4. 十大主星・十二大従星の計算方法
5. 天中殺の計算方法

## 期待する回答形式

1. **計算ロジックの正誤判定**: 各計算方法が正しいか、間違っているか
2. **間違っている場合の修正方法**: 正しい計算方法を具体的に説明
3. **流派による違い**: 異なる計算方法がある場合、その違いを説明
4. **参照すべき文献**: 正確な情報が得られる文献やWebサイト

## 具体的な検証依頼

特に、以下の点を明確にしてください：

1. 1995年9月14日のケースで、胸が「調舒星」になる正しい計算方法
2. 月支（酉）の蔵干がどのような条件下で「木」になるのか
3. 陽占の計算で使用する蔵干は、通常の蔵干と異なる特殊な定義なのか

以上、よろしくお願いします。
