# 数理法エネルギー値検証レポート

**検証日**: 2026-02-11
**検証者**: AI検証チーム
**検証対象**: `tools/sanmei-cli-suriho.ts` の数理法エネルギー計算ロジック

---

## 1. 検証目的

- ランダムな生年月日でエネルギー値の分布を確認
- 最大値343点、平均値200点に近い値が出るかを検証
- 正常な分布かどうかを判断

---

## 2. 検証方法

### 2.1 検証スクリプト
- **ファイル**: `tools/verify-suriho-distribution.ts`
- **検証パターン**:
  - ランダム検証（1000件）
  - 全探索検証（1950-2010年、1464件）

### 2.2 検証対象
- 生年月日範囲: 1950年〜2010年
- 性別: 男性（計算結果に影響しないことを確認）

---

## 3. 検証結果

### 3.1 ランダム検証（1000件）

#### 統計サマリー
| 項目 | 実測値 | 理論値 | 差異 | 差異率 |
|------|--------|--------|------|--------|
| サンプル数 | 1,000件 | - | - | - |
| 最小値 | 90点 | 64点 | +26点 | +40.6% |
| 最大値 | 196点 | 343点 | **-147点** | **-42.9%** |
| 平均値 | 126.95点 | 200点 | **-73.05点** | **-36.5%** |
| 中央値 | 125点 | - | - | - |
| 標準偏差 | 16.05点 | - | - | - |

#### エネルギー値の分布
| 点数範囲 | 件数 | 割合 |
|----------|------|------|
| 64-100点 | 30件 | 3.0% |
| 100-150点 | 888件 | **88.8%** |
| 150-200点 | 82件 | 8.2% |
| 200-250点 | 0件 | 0.0% |
| 250-300点 | 0件 | 0.0% |
| 300-343点 | 0件 | 0.0% |

**重要な発見**:
- **200点以上の生年月日は0件**（1000件中）
- **300点以上の生年月日は0件**（1000件中）
- 88.8%が100-150点の範囲に集中

#### 排気口の分布
| 排気口範囲 | 件数 | 割合 |
|------------|------|------|
| 1-3 | 35件 | 3.5% |
| 3-5 | 208件 | 20.8% |
| 5-7 (理想範囲) | 332件 | 33.2% |
| 7-9 (理想範囲) | 297件 | 29.7% |
| 9-11 | 114件 | 11.4% |

**排気口の分析**:
- 62.9%が理想範囲（5-9）に入っている
- 排気口の計算は正常に機能している

#### 五行別平均エネルギー
| 五行 | 平均エネルギー |
|------|----------------|
| 木 | 24.92点 |
| 火 | 22.98点 |
| 土 | 29.02点 |
| 金 | 23.56点 |
| 水 | 26.47点 |
| **合計** | **126.95点** |

**五行の分析**:
- 五行のバランスは比較的均等
- 土がやや高め、火がやや低め
- 全体的なバランスは正常

### 3.2 全探索検証（1950-2010年、1464件）

#### 統計サマリー
| 項目 | 実測値 | 理論値 | 差異 | 差異率 |
|------|--------|--------|------|--------|
| サンプル数 | 1,464件 | - | - | - |
| 最小値 | 90点 | 64点 | +26点 | +40.6% |
| 最大値 | 207点 | 343点 | **-136点** | **-39.7%** |
| 平均値 | 127.02点 | 200点 | **-72.98点** | **-36.5%** |
| 中央値 | 125点 | - | - | - |
| 標準偏差 | 15.33点 | - | - | - |

#### エネルギー値 トップ20

| 順位 | 生年月日 | エネルギー値 | 排気口 | 五行内訳（木火土金水） |
|------|----------|--------------|--------|------------------------|
| 1 | 1983-12-01 | 207点 | 12 | 0, 0, 0, 0, 207 |
| 2 | 1977-07-01 | 194点 | 11 | 0, 128, 66, 0, 0 |
| 3 | 1988-07-01 | 194点 | 10.3 | 0, 95, 99, 0, 0 |
| 4 | 1979-07-01 | 189点 | 11 | 0, 64, 99, 26, 0 |
| 5 | 1963-03-01 | 188点 | 8.3 | 138, 0, 0, 0, 50 |
| 6 | 1998-04-01 | 188点 | 8.3 | 138, 0, 50, 0, 0 |
| 7 | 1982-12-15 | 186点 | 10.3 | 0, 0, 0, 31, 155 |
| 8 | 1989-06-15 | 185点 | 11.7 | 0, 105, 34, 46, 0 |
| 9 | 1978-06-01 | 180点 | 2.7 | 8, 137, 35, 0, 0 |
| 10 | 1988-03-01 | 180点 | 11 | 128, 0, 52, 0, 0 |

**高エネルギー値の傾向**:
- 水のエネルギーが突出するケースが多い（1983-12-01: 水のみ207点）
- 特定の五行に偏る傾向がある
- 最大値でも207点と、理論値343点に遠く及ばない

#### エネルギー値 ボトム20

| 順位 | 生年月日 | エネルギー値 | 排気口 | 五行内訳（木火土金水） |
|------|----------|--------------|--------|------------------------|
| 1 | 2009-02-01 | 90点 | 5 | 0, 30, 60, 0, 0 |
| 2 | 2001-03-15 | 91点 | 7 | 26, 21, 0, 44, 0 |
| 3 | 1960-07-01 | 92点 | 3.3 | 20, 14, 0, 20, 38 |
| 4 | 1950-01-01 | 93点 | 4.3 | 0, 26, 26, 18, 23 |
| 5 | 1950-01-15 | 93点 | 4.7 | 0, 33, 13, 47, 0 |

**低エネルギー値の傾向**:
- 五行がバランスよく分散している
- 特定の五行に極端な偏りがない
- 排気口は正常な範囲（3-7）内

---

## 4. 問題点の分析

### 4.1 重大な問題点

#### 問題1: 平均値が理論値を大幅に下回る
- **理論値**: 200点
- **実測値**: 127.02点
- **差異**: -72.98点 (-36.5%)

**影響**:
- ほぼ全ての生年月日でエネルギー値が過小評価されている
- キャラクターの運命エネルギーが正しく表現できない

#### 問題2: 最大値が理論値を大幅に下回る
- **理論値**: 343点
- **実測値**: 207点
- **差異**: -136点 (-39.7%)

**影響**:
- 高エネルギー値を持つキャラクターを作成できない
- 「特別な運命」を持つキャラクターが表現できない

#### 問題3: 200点以上の生年月日が存在しない
- **1000件中0件**
- **1464件中0件**

**影響**:
- 平均値以上のキャラクターが存在しない
- 理論上の分布が実現できていない

### 4.2 考えられる原因

#### 原因1: 数理法の計算ロジックの誤り
現在の実装（`sanmei-cli-suriho.ts`の`calculateSurihoEnergy`関数）では:

```typescript
// 各十干について、宿命の十二支との組み合わせでスコアを計算
for (const gan of GAN) {
    const count = ganCount[gan];
    if (count === 0) continue;

    let totalScore = 0;

    // その十干の個数分だけループ
    for (const shi of shiSet) {
        const jusei = getJunidaiJusei(gan, shi);
        totalScore += jusei.score;
    }

    details[gan] = {
        score: totalScore * count,  // 十干の個数を掛ける
        count: count
    };
}
```

**問題点**:
- `shiSet` には**最大3種類の十二支**しか含まれない（年・月・日）
- 各十干のスコア計算で、十二支の数が限定的
- 理論上は「陰占内の全ての十二支」を使用すべき可能性

#### 原因2: 十干個数のカウント方法
現在の実装では:

```typescript
const countGanInInsen = (insen: Insen): GanCount => {
    const count: GanCount = {};
    GAN.forEach(g => count[g] = 0);

    // 年柱
    count[insen.year.gan]++;
    if (insen.year.zokan) count[insen.year.zokan]++;

    // 月柱
    count[insen.month.gan]++;
    if (insen.month.zokan) count[insen.month.zokan]++;

    // 日柱
    count[insen.day.gan]++;
    if (insen.day.zokan) count[insen.day.zokan]++;

    return count;
};
```

**問題点**:
- 十干の最大個数は**6個**（年干・年蔵干・月干・月蔵干・日干・日蔵干）
- 理論上の最大エネルギー343点を達成するには、より多くの十干が必要可能性

#### 原因3: 十二大従星の点数配分
現在の十二大従星の点数:

| 従星 | 点数 |
|------|------|
| 天将星 | 12点 |
| 天禄星 | 11点 |
| 天南星 | 10点 |
| 天貴星 | 9点 |
| 天堂星 | 8点 |
| 天恍星 | 7点 |
| 天印星 | 6点 |
| 天庫星 | 5点 |
| 天報星 | 3点 |
| 天胡星 | 4点 |
| 天極星 | 2点 |
| 天馳星 | 1点 |

**問題点**:
- 点数配分自体に誤りがある可能性
- 数理法の原著と異なる点数配分を使用している可能性

#### 原因4: 計算式自体の見直しの必要性
現在の計算式:

```typescript
totalScore * count
```

**問題点**:
- この計算式が数理法の正しい実装か不明
- 「十干の個数 × （十二支との組み合わせスコアの合計）」が正しいか確認が必要

---

## 5. 推奨される対応

### 5.1 即時対応（優先度高）

1. **数理法の原著・参考資料を再確認**
   - 数理法の計算方法を詳しく記述した文献を入手
   - 計算式の正確な実装方法を確認

2. **計算ロジックのステップバイステップでの検証**
   - 各ステップで中間値を出力
   - 理論値と比較しながら検証

3. **既存の実装との比較**
   - 他の算命学ライブラリの実装を調査
   - 計算結果を比較検証

### 5.2 中期対応（優先度中）

1. **専門家への確認**
   - 算命学の専門家に計算結果の正確性を確認
   - 数理法の正しい実装方法について相談

2. **テストケースの作成**
   - 理論値が明確なテストケースを作成
   - 自動テストで常に正確性を確認

### 5.3 長期対応（優先度低）

1. **数理法計算ライブラリの再設計**
   - 正しい実装に基づいてライブラリを再設計
   - モジュール化してテスト容易性を向上

2. **ドキュメントの整備**
   - 数理法の計算方法を詳細にドキュメント化
   - 将来のメンテナンス性を向上

---

## 6. 結論

### 6.1 検証結果のサマリー

| 項目 | 結果 | 評価 |
|------|------|------|
| 平均値の正確性 | 127.02点（理論値200点） | ❌ 不合格 |
| 最大値の正確性 | 207点（理論値343点） | ❌ 不合格 |
| 分布の正常性 | 88.8%が100-150点に集中 | ❌ 不合格 |
| 200点以上の存在 | 0件 | ❌ 不合格 |

### 6.2 最終評価

**現在の数理法実装には重大な問題があり、実運用には不適**

**具体的な問題**:
- 平均値が理論値より36.5%低い
- 最大値が理論値より39.7%低い
- 200点以上の生年月日が存在しない
- 理論上の分布が実現できていない

**推奨アクション**:
1. 数理法の計算ロジックを根本から見直す
2. 正しい実装方法を文献や専門家から確認する
3. テストケースを作成して正確性を継続的に検証する

---

## 7. 付録

### 7.1 検証スクリプト
- **ファイル**: `tools/verify-suriho-distribution.ts`
- **実行コマンド**: `npx tsx tools/verify-suriho-distribution.ts`

### 7.2 検証データ
- **ランダム検証**: 1000件
- **全探索検証**: 1464件（1950-2010年、毎月1日と15日）

### 7.3 関連ファイル
- `tools/sanmei-cli-suriho.ts`: 数理法エネルギー計算の実装
- `tools/sanmei-cli.ts`: 算命学計算のメイン実装

---

**レポート作成日**: 2026-02-11
**検証チーム**: AI検証チーム
**承認**: 保留中
