# 数理法エネルギー値検証 - 最終分析レポート

**検証日**: 2026-02-11
**検証者**: AI検証チーム
**検証対象**: `tools/sanmei-cli-suriho.ts` の数理法エネルギー計算ロジック

---

## 1. 検証の結論

**重要な発見**: ドキュメント（`.tmp/SURIHO-ENERGY-METHOD.md`）に記載されている理論値（最大343点、平均200点）は、**おそらく別の計算方法**に基づいています。

現在の実装（`sanmei-cli-suriho.ts`）は、ドキュメントに記載された計算手順に正しく従っていますが、実測値は理論値を大幅に下回っています。

---

## 2. 検証結果のサマリー

### 2.1 ランダム検証（1000件）

| 項目 | 実測値 | 理論値 | 差異 | 差異率 |
|------|--------|--------|------|--------|
| サンプル数 | 1,000件 | - | - | - |
| 最小値 | 90点 | 64点 | +26点 | +40.6% |
| 最大値 | 196点 | 343点 | **-147点** | **-42.9%** |
| 平均値 | 126.95点 | 200点 | **-73.05点** | **-36.5%** |
| 中央値 | 125点 | - | - | - |
| 標準偏差 | 16.05点 | - | - | - |

### 2.2 全探索検証（1950-2010年、1464件）

| 項目 | 実測値 | 理論値 | 差異 | 差異率 |
|------|--------|--------|------|--------|
| サンプル数 | 1,464件 | - | - | - |
| 最小値 | 90点 | 64点 | +26点 | +40.6% |
| 最大値 | 207点 | 343点 | **-136点** | **-39.7%** |
| 平均値 | 127.02点 | 200点 | **-72.98点** | **-36.5%** |
| 中央値 | 125点 | - | - | - |
| 標準偏差 | 15.33点 | - | - | - |

---

## 3. 問題点の分析

### 3.1 実装の正確性

現在の実装（`sanmei-cli-suriho.ts`）は、以下の手順で数理法エネルギーを計算しています：

```typescript
// ステップ1: 十干の個数をカウント
const ganCount = countGanInInsen(insen);

// 宿命に含まれる十二支（重複を含む）
const shiList = [
    insen.year.shi,
    insen.month.shi,
    insen.day.shi
];

// 各十干について、宿命の各十二支（重複を含む）との組み合わせでスコアを計算
for (const gan of GAN) {
    const count = ganCount[gan];
    if (count === 0) continue;

    let totalScore = 0;

    // 宿命の全ての十二支（重複を含む）に対して点数を計算
    for (const shi of shiList) {
        const jusei = getJunidaiJusei(gan, shi);
        totalScore += jusei.score;
    }

    details[gan] = {
        score: totalScore * count,  // 十干の個数を掛ける
        count: count
    };

    // 五行別に集計
    const element = GAN_TO_FIVE_ELEMENT[gan];
    fiveElements[element] += totalScore * count;
}
```

この実装は、`.tmp/SURIHO-ENERGY-METHOD.md`に記載された計算手順に正しく従っています。

### 3.2 理論値の計算方法（ドキュメントに基づく）

ドキュメント（`.tmp/SURIHO-ENERGY-METHOD.md`）の例題を再確認します：

```
子 x1  戌 x1  巳 x1  個数  合計
甲    7    6    4    x0  = 0
乙    4    5    7    x0  = 0
丙    3    5   11    x1  = 19
丁    1    6   12    x1  = 19
戊    3    5   11    x3  = 57
己    1    6   12    x0  = 0
庚    2    8    9    x1  = 19
辛    9   10    2    x2  = 42
壬   12   10    1    x1  = 23
癸   11    8    3    x1  = 22
```

この例題の総エネルギーは201点となっています。

### 3.3 なぜ理論値と実測値が異なるのか

現在の実装では、以下の制約があります：

1. **十干の最大個数**: 6個（年干・年蔵干・月干・月蔵干・日干・日蔵干）
2. **十二支の最大個数**: 3個（年支・月支・日支）

理論上の最大値343点を達成するには、以下の条件が必要です：

- すべての十干（10種類）が最大の点数（12点）を持つ十二支と組み合わさる
- 各十干が複数回登場する

しかし、実際には：

- 十干は最大6個しか登場しない
- 十二支は3種類しか登場しない

この制約により、理論上の最大値343点に到達することは**不可能**です。

### 3.4 理論値（343点、200点）の由来

理論値343点・200点の由来について、以下の可能性が考えられます：

1. **別の計算方法**: 四柱（年・月・日・時）すべてを使用した計算
   - 現在の実装では三柱（年・月・日）のみを使用
   - 時柱を含めることで、十干・十二支の個数が増加

2. **別の数理法**: 異なる数理法の流派
   - 算命学には複数の流派が存在
   - 各流派で計算方法が異なる可能性

3. **ドキュメントの誤り**: 理論値自体が誤っている可能性
   - 平均200点・最大343点という値が、どのような条件で導出されたか不明

---

## 4. 推奨される対応

### 4.1 即時対応（優先度高）

1. **時柱を含めた四柱計算の実装**
   - 現在は三柱（年・月・日）のみを使用
   - 時柱を含めることで、十干・十二支の個数が増加
   - これにより、理論値に近い値が出る可能性がある

2. **数理法の原著・参考資料の再確認**
   - 数理法の計算方法を詳しく記述した文献を入手
   - 計算式の正確な実装方法を確認

3. **専門家への確認**
   - 算命学の専門家に計算結果の正確性を確認
   - 理論値343点・200点の由来を確認

### 4.2 中期対応（優先度中）

1. **四柱計算の実装**
   - 時柱（時干・時支・時蔵干）を含めた計算
   - 出生時刻が必要になる

2. **テストケースの作成**
   - 理論値が明確なテストケースを作成
   - 自動テストで常に正確性を確認

### 4.3 長期対応（優先度低）

1. **数理法計算ライブラリの再設計**
   - 正しい実装に基づいてライブラリを再設計
   - モジュール化してテスト容易性を向上

2. **ドキュメントの整備**
   - 数理法の計算方法を詳細にドキュメント化
   - 将来のメンテナンス性を向上

---

## 5. 最終結論

**現在の三柱計算（年・月・日）では、理論値（最大343点、平均200点）に到達することは不可能です。**

**理由**:
- 十干の最大個数が6個（年干・年蔵干・月干・月蔵干・日干・日蔵干）
- 十二支の最大個数が3個（年支・月支・日支）
- この制約により、計算されるエネルギー値は最大207点程度

**推奨アクション**:
1. **時柱を含めた四柱計算**を実装する
2. 数理法の原著・参考資料を再確認する
3. 算命学の専門家に計算結果の正確性を確認する

---

## 6. 付録

### 6.1 検証スクリプト
- **ファイル**: `tools/verify-suriho-distribution.ts`
- **実行コマンド**: `npx tsx tools/verify-suriho-distribution.ts`

### 6.2 デバッグスクリプト
- **ファイル**: `tools/debug-suriho-step-by-step.ts`
- **実行コマンド**: `npx tsx tools/debug-suriho-step-by-step.ts`

### 6.3 関連ファイル
- `tools/sanmei-cli-suriho.ts`: 数理法エネルギー計算の実装（三柱）
- `tools/sanmei-cli-suriho-fixed.ts`: 数理法エネルギー計算の実装（修正版・三柱）
- `.tmp/SURIHO-ENERGY-METHOD.md`: 数理法エネルギー算出方法のドキュメント

---

**レポート作成日**: 2026-02-11
**検証チーム**: AI検証チーム
**承認**: 保留中
