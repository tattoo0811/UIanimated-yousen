# Agent Instructions

This project uses **bd** (beads) for issue tracking. Run `bd onboard` to get started.

## Quick Reference

```bash
bd ready              # Find available work
bd show <id>          # View issue details
bd update <id> --status in_progress  # Claim work
bd close <id>         # Complete work
bd sync               # Sync with git
```

---

## âš ï¸ é‡è¦ï¼šã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æ€§åˆ¥ã¨å¤§é‹ãƒ«ãƒ¼ãƒ«

### æ­£ã—ã„ä¸»è¦ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š

| ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ | ç”Ÿå¹´æœˆæ—¥ | **æ€§åˆ¥** | å¹´å¹² | å¤§é‹ | ç«‹é‹ | ã‚¨ãƒãƒ«ã‚®ãƒ¼ |
|------------|---------|----------|------|------|------|---------|
| ä¹æ¡ å·¡ | 1990-03-02 | **ç”·æ€§** âš ï¸ | åºšï¼ˆé™½ï¼‰ | **é †è¡Œ** | **2æ­³** | 267ç‚¹ |
| è—¤å ‚ æ…§ | 1990-05-25 | ç”·æ€§ | åºšï¼ˆé™½ï¼‰ | é †è¡Œ | 4æ­³ | 255ç‚¹ |
| ä¹æ¡ ã•ãã‚‰ | 1925-07-30 | å¥³æ€§ | ä¹™ï¼ˆé™°ï¼‰ | **é †è¡Œ** | 3æ­³ | 204ç‚¹ |
| é«˜æ©‹ ç¾å’² | 1999-05-03 | å¥³æ€§ | å·±ï¼ˆé™°ï¼‰ | **é †è¡Œ** | 1æ­³ | 196ç‚¹ |

### ğŸ”´ å¤§é‹ã®é †è¡Œãƒ»é€†è¡Œãƒ«ãƒ¼ãƒ«ï¼ˆçµ¶å¯¾éµå®ˆï¼‰

```typescript
// æ­£ã—ã„å¤§é‹é †é€†åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
const isMale = gender === 'male';
const isYGanYang = GAN.indexOf(yGan) % 2 === 0;
const isForward = (isYGanYang && isMale) || (!isYGanYang && !isMale);
```

**ãƒ«ãƒ¼ãƒ«**:
- **ç”·æ€§**: é™½å¹´ï¼ˆç”²ãƒ»ä¸™ãƒ»æˆŠãƒ»åºšãƒ»å£¬ï¼‰â†’ é †è¡Œã€é™°å¹´ï¼ˆä¹™ãƒ»ä¸ãƒ»å·±ãƒ»è¾›ãƒ»ç™¸ï¼‰â†’ é€†è¡Œ
- **å¥³æ€§**: é™°å¹´ï¼ˆä¹™ãƒ»ä¸ãƒ»å·±ãƒ»è¾›ãƒ»ç™¸ï¼‰â†’ **é †è¡Œ**ã€é™½å¹´ï¼ˆç”²ãƒ»ä¸™ãƒ»æˆŠãƒ»åºšãƒ»å£¬ï¼‰â†’ é€†è¡Œ

**ã‚ˆãã‚ã‚‹é–“é•ã„** âŒ:
- ã€Œå¥³æ€§ã¯ã™ã¹ã¦é€†è¡Œã€â†’ é–“é•ã„ï¼é™°å¹´å¥³æ€§ã¯é †è¡Œ
- ã€Œé™°å¹´ã¯é€†è¡Œã€â†’ æ€§åˆ¥ã¨çµ„ã¿åˆã‚ã›ã¦åˆ¤æ–­

---

## ç®—å‘½å­¦è¨ˆç®—ãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆ

### ä½¿ç”¨ä¸­ã®ãƒ„ãƒ¼ãƒ«ï¼ˆæœ€æ–°ç‰ˆï¼‰

#### 1. sanmei-cli-v3.ts - åŸºæœ¬CLIãƒ„ãƒ¼ãƒ«
**é™°å ãƒ»é™½å ãƒ»å¤§é‹è¨ˆç®—ï¼ˆè©³ç´°ãªè”µå¹²ãƒ‡ãƒ¼ã‚¿ä»˜ãï¼‰**

```bash
cd /Users/kitamuratatsuhiko/UIanimated/tools
npx tsx sanmei-cli-v3.ts <YYYY-MM-DD> <male|female>

# ä¾‹ï¼šä¹æ¡ å·¡ï¼ˆ1990-03-02 ç”·æ€§ï¼‰âš ï¸
npx tsx sanmei-cli-v3.ts 1990-03-02 male
```

**ç‰¹å¾´**:
- æ­£ç¢ºãªäºŒåå…«å…ƒè¨ˆç®—ï¼ˆç¯€å…¥ã‚Šæ—¥è€ƒæ…®ï¼‰
- è©³ç´°ãªè”µå¹²ãƒ‡ãƒ¼ã‚¿ï¼ˆåˆå…ƒãƒ»ä¸­å…ƒãƒ»æœ¬å…ƒã®å€™è£œãƒªã‚¹ãƒˆï¼‰
- å®Œå…¨ãªé™½å ç”¨ãƒ‡ãƒ¼ã‚¿ï¼ˆåå¤§ä¸»æ˜Ÿãƒ»åäºŒå¤§å¾“æ˜Ÿï¼‰
- å¤§é‹ã®å³å¯†ãªè¨ˆç®—ï¼ˆé †è¡Œãƒ»é€†è¡Œã€ç«‹é‹ã®æ­£ç¢ºãªç®—å‡ºï¼‰

#### 2. sanmei-with-energy-cli.ts - ã‚¨ãƒãƒ«ã‚®ãƒ¼è¨ˆç®—ä»˜ãCLI
**æ•°ç†æ³•ã‚¨ãƒãƒ«ã‚®ãƒ¼è¨ˆç®—ã‚’å«ã‚€å®Œå…¨ç‰ˆ**

```bash
npx tsx sanmei-with-energy-cli.ts <YYYY-MM-DD> <male|female> --format json
```

**ç‰¹å¾´**:
- æ•°ç†æ³•ã‚¨ãƒãƒ«ã‚®ãƒ¼è¨ˆç®—ï¼ˆPDF 201804_æ•°ç†æ³•_rev2.0.2.pdf æº–æ‹ ï¼‰
- äº”è¡Œåˆ¥ã‚¹ã‚³ã‚¢è¡¨ç¤º
- å…«é–€æ³•ã«ã‚ˆã‚‹å‹åˆ¤å®š
- JSONå½¢å¼å‡ºåŠ›ï¼ˆAIé€£æºå‘ã‘ï¼‰

#### 3. sanmei-app-v3.tsx - Reactã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
**ãƒ–ãƒ©ã‚¦ã‚¶ã§ä½¿ç”¨å¯èƒ½ãªç®—å‘½å­¦ã‚¢ãƒ—ãƒª**

```bash
# Next.jsã‚¢ãƒ—ãƒªã«çµ„ã¿è¾¼ã¿æ¸ˆã¿
# ã‚¢ã‚¯ã‚»ã‚¹: http://localhost:3001/sanmei
```

**ç‰¹å¾´**:
- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªUI
- é™°å ãƒ»é™½å ãƒ»å¤§é‹ãƒ»æ•°ç†æ³•ã®çµ±åˆè¡¨ç¤º
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ˆç®—
- å…«é–€æ³•ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤º

---

## å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### sanmei-cli-v3.ts ã®å‡ºåŠ›

```json
{
  "input": {
    "date": "1990-03-02",
    "gender": "female"
  },
  "insen": {
    "year": {
      "gan": "åºš",
      "shi": "åˆ",
      "zokan": {
        "selected": "æˆŠ",
        "type": "main",
        "candidates": {
          "initial": "å£¬",
          "main": "æˆŠ"
        }
      }
    },
    "month": { "gan": "æˆŠ", "shi": "å¯…", "zokan": {...} },
    "day": { "gan": "ä¸™", "shi": "å¯…", "zokan": {...} },
    "setsuiriDay": 6
  },
  "yousen": {
    "north": "ç¦„å­˜æ˜Ÿ",
    "south": "å¸ç¦„æ˜Ÿ",
    "east": "èª¿èˆ’æ˜Ÿ",
    "west": "ç‰½ç‰›æ˜Ÿ",
    "center": "è²«ç´¢æ˜Ÿ",
    "start": { "name": "å¤©åº«æ˜Ÿ", "sub": "å¢“", "score": 5 },
    "middle": { "name": "å¤©ç¦„æ˜Ÿ", "sub": "å»ºç¦„", "score": 11 },
    "end": { "name": "å¤©è²´æ˜Ÿ", "sub": "é•·ç”Ÿ", "score": 9 }
  },
  "taiun": {
    "isForward": false,
    "ritsuun": 9,
    "list": [ /* 10æ—¬åˆ†ã®å¤§é‹ãƒ‡ãƒ¼ã‚¿ */ ]
  }
}
```

### sanmei-with-energy-cli.ts ã®å‡ºåŠ›ï¼ˆæ•°ç†æ³•ä»˜ãï¼‰

ä¸Šè¨˜ã«åŠ ãˆã€ä»¥ä¸‹ã‚’å«ã‚€ï¼š

```json
{
  "suriho": {
    "total_energy": 267,
    "gogyo_scores": {
      "æœ¨": 56,
      "ç«": 85,
      "åœŸ": 42,
      "é‡‘": 0,
      "æ°´": 84
    },
    "details": [ /* å„åå¹²ã®è©³ç´°ã‚¹ã‚³ã‚¢ */ ]
  }
}
```

---

## é‡è¦ãªç‰¹å¾´

### 1. æ­£ç¢ºãªäºŒåå…«å…ƒè¨ˆç®—
- ç¯€å…¥ã‚Šæ—¥ã‚’è€ƒæ…®ã—ãŸæ­£ç¢ºãªè”µå¹²è¨ˆç®—
- åˆå…ƒãƒ»ä¸­å…ƒãƒ»æœ¬å…ƒã®å€™è£œãƒªã‚¹ãƒˆã‚’å«ã‚€è©³ç´°ãƒ‡ãƒ¼ã‚¿
- é™°é™½é †é€†ã«åŸºã¥ãæ­£ç¢ºãªå¤§é‹è¨ˆç®—

### 2. æ•°ç†æ³•ã‚¨ãƒãƒ«ã‚®ãƒ¼è¨ˆç®—ï¼ˆPDFæº–æ‹ ï¼‰
- PDFã€Œ201804_æ•°ç†æ³•_rev2.0.2.pdfã€ã®æ­£ã—ã„ã‚¨ãƒãƒ«ã‚®ãƒ¼ç‚¹æ•°è¡¨ã‚’ä½¿ç”¨
- å…¨è”µå¹²ï¼ˆæ•°ç†æ³•ç”¨ï¼‰ã‚’è€ƒæ…®ã—ãŸè¨ˆç®—
- PDFä¾‹é¡Œï¼ˆå£¬å­ / æˆŠæˆŒ / è¾›å·³ = 201ç‚¹ï¼‰ã¨å®Œå…¨ã«ä¸€è‡´ âœ“

### 3. æ¤œè¨¼æ¸ˆã¿
- localhost:3001ã®Reactã‚¢ãƒ—ãƒªçµæœã¨å®Œå…¨ã«ä¸€è‡´
- `/Users/kitamuratatsuhiko/stella-check/app/page3.tsx` ã§ç›®è¦–æ¤œè¨¼æ¸ˆã¿
- ä¸»è¦ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®æ­£ã—ã„ãƒ‡ãƒ¼ã‚¿ï¼š
  - ä¹æ¡ å·¡ï¼ˆ1990-03-02ã€**ç”·æ€§**ï¼‰: **267ç‚¹**ã€é †è¡Œã€ç«‹é‹2æ­³
  - è—¤å ‚ æ…§ï¼ˆ1990-05-25ã€ç”·æ€§ï¼‰: **255ç‚¹**ã€é †è¡Œã€ç«‹é‹4æ­³
  - ä¹æ¡ ã•ãã‚‰ï¼ˆ1925-07-30ã€å¥³æ€§ï¼‰: **204ç‚¹**ã€é †è¡Œã€ç«‹é‹3æ­³
  - é«˜æ©‹ ç¾å’²ï¼ˆ1999-05-03ã€å¥³æ€§ï¼‰: **196ç‚¹**ã€é †è¡Œã€ç«‹é‹1æ­³

**ğŸ”´ 2026-02-11 é‡è¦ãªè¨‚æ­£**:
- å·¡ã®æ€§åˆ¥ã‚’ã€Œå¥³æ€§ã€ã‹ã‚‰ã€Œç”·æ€§ã€ã«è¨‚æ­£ï¼ˆä»¥å‰ã®è¨ˆç®—ã¯é–“é•ã„ï¼‰
- å¤§é‹é †é€†ãƒ«ãƒ¼ãƒ«ï¼šå¥³æ€§ã®é™°å¹´ï¼ˆä¹™ãƒ»ä¸ãƒ»å·±ãƒ»è¾›ãƒ»ç™¸ï¼‰ã¯ã€Œé †è¡Œã€
- stella-checkã‚¢ãƒ—ãƒªã§å…¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®å¤§é‹ä¸¦ã³ã‚’æ¤œè¨¼æ¸ˆã¿

---

## ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã«ã¤ã„ã¦

å¤ã„ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•æ¸ˆã¿ï¼š

```
.backup/deprecated-tools-20260211-135504/
â”œâ”€â”€ debug-suriho-step-by-step.ts
â”œâ”€â”€ sanmei-cli-suriho-fixed.ts
â”œâ”€â”€ sanmei-cli-suriho.ts
â”œâ”€â”€ sanmei-cli.ts
â”œâ”€â”€ sanmei-v2.ts
â”œâ”€â”€ test-pdf-example.ts
â””â”€â”€ verify-suriho-distribution.ts
```

**ä½¿ç”¨ä¸­ã®æœ€æ–°ãƒ„ãƒ¼ãƒ«ï¼ˆæ®‹ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ï¼‰**:
- `sanmei-cli-v3.ts` - åŸºæœ¬CLI
- `sanmei-with-energy-cli.ts` - ã‚¨ãƒãƒ«ã‚®ãƒ¼è¨ˆç®—ä»˜ãCLI
- `sanmei-app-v3.tsx` - Reactã‚¢ãƒ—ãƒª

---

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### å®Ÿè£…ã‚³ãƒ¼ãƒ‰
- **åŸºæœ¬CLI**: `/Users/kitamuratatsuhiko/UIanimated/tools/sanmei-cli-v3.ts`
- **ã‚¨ãƒãƒ«ã‚®ãƒ¼ä»˜ãCLI**: `/Users/kitamuratatsuhiko/UIanimated/tools/sanmei-with-energy-cli.ts`
- **Reactã‚¢ãƒ—ãƒª**: `/Users/kitamuratatsuhiko/UIanimated/src/app/sanmei/page.tsx`

### é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å‘½å¼ãƒ‡ãƒ¼ã‚¿: `/Users/kitamuratatsuhiko/UIanimated/claudedocs/CHARACTERS-AGE-RELATIONSHIPS.md`

---

## ç®—å‘½å­¦ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ãƒ—ãƒ­ã‚»ã‚¹

ç®—å‘½å­¦ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œè¨¼ã™ã‚‹éš›ã¯ã€å¿…ãšä»¥ä¸‹ã®ãƒ—ãƒ­ã‚»ã‚¹ã«å¾“ã†ã“ã¨ï¼š

### é‡è¦: æœ±å­¦é™¢æ¤œè¨¼ã®å³å¯†åŒ–

**èªè­˜ãƒŸã‚¹é˜²æ­¢ã®ãŸã‚ã®ãƒ«ãƒ¼ãƒ«**:

1. **å¿…ãšã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’å–å¾—**
   - ç›®è¦–ã§ã®ç¢ºèªã¯ç¦æ­¢
   - ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’è¨¼æ‹ ã¨ã—ã¦ä¿å­˜

2. **äººä½“å›³ã®æ¨™æº–ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆ3x3æ§‹é€ ï¼‰**
   ```
         ç©ºç™½      é ­        å·¦è‚©        â† è¡Œ0 (ä¸Šæ®µ)
            å³æ‰‹      èƒ¸        å·¦æ‰‹        â† è¡Œ1 (ä¸­æ®µ)
            å³è¶³      è…¹        å·¦è¶³        â† è¡Œ2 (ä¸‹æ®µ)
   ```

3. **ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºã®å³å¯†ãªé †åº**
   - åŸºæœ¬æƒ…å ±ï¼ˆç”Ÿå¹´æœˆæ—¥ãƒ»æ™‚åˆ»ãƒ»æ€§åˆ¥ãƒ»å ´æ‰€ï¼‰
   - å››æŸ±æ¨å‘½ï¼ˆå¹´æŸ±ãƒ»æœˆæŸ±ãƒ»æ—¥æŸ±ãƒ»æ™‚æŸ±ï¼‰
   - åå¤§ä¸»æ˜Ÿï¼ˆé ­â†’èƒ¸â†’è…¹â†’å³æ‰‹â†’å·¦æ‰‹ï¼‰
   - åäºŒå¤§å¾“æ˜Ÿï¼ˆå·¦è‚©â†’å·¦è¶³â†’å³è¶³ï¼‰
   - å¤©ä¸­æ®ºï¼ˆã‚ã‚Š/ãªã—ï¼‰

4. **ç…§åˆãƒ—ãƒ­ã‚»ã‚¹**
   - ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‹ã‚‰æŠ½å‡º
   - DOMã‹ã‚‰ç›´æ¥å–å¾—
   - ä¸¡è€…ãŒä¸€è‡´ã™ã‚‹ã“ã¨ã‚’ç¢ºèª

5. **è©³ç´°ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**
   - `.claude/skills/SHUGAKUIN-VERIFICATION.md` ã‚’å‚ç…§

**é•åã—ãŸå ´åˆã®åæœ**:
- èª¤ã£ãŸãƒ­ã‚¸ãƒƒã‚¯ä¿®æ­£ã«ã¤ãªãŒã‚‹
- æ—¢å­˜ã®æ¤œè¨¼ãƒ‡ãƒ¼ã‚¿ã‚’ç ´å£Šã™ã‚‹å¯èƒ½æ€§
- æ™‚é–“ã®ç„¡é§„

---

## Landing the Plane (Session Completion)

**When ending a work session**, you MUST complete ALL steps below. Work is NOT complete until `git push` succeeds.

**MANDATORY WORKFLOW:**

1. **File issues for remaining work** - Create issues for anything that needs follow-up
2. **Run quality gates** (if code changed) - Tests, linters, builds
3. **Update issue status** - Close finished work, update in-progress items
4. **PUSH TO REMOTE** - This is MANDATORY:
   ```bash
   git pull --rebase
   bd sync
   git push
   git status  # MUST show "up to date with origin"
   ```
5. **Clean up** - Clear stashes, prune remote branches
6. **Verify** - All changes committed AND pushed
7. **Hand off** - Provide context for next session

**CRITICAL RULES:**
- Work is NOT complete until `git push` succeeds
- NEVER stop before pushing - that leaves work stranded locally
- NEVER say "ready to push when you are" - YOU must push
- If push fails, resolve and retry until it succeeds
