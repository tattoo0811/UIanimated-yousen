---
phase: 04-video-generation-backend
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - backend/src/compositions/HookComposition.tsx
  - backend/src/compositions/VideoTemplate.tsx
  - backend/src/compositions/themes/themeConfig.ts
autonomous: true

user_setup: []

must_haves:
  truths:
    - "VideoTemplate component renders 9:16 vertical video (1080x1920, 30fps)"
    - "VideoTemplate integrates theme system with visual styling"
    - "HookComposition is updated to use VideoTemplate component"
  artifacts:
    - path: "backend/src/compositions/VideoTemplate.tsx"
      provides: "Base video template component"
      exports: ["VideoTemplate"]
    - path: "backend/src/compositions/themes/themeConfig.ts"
      provides: "Theme configuration"
      exports: ["themeConfig"]
    - path: "backend/src/compositions/HookComposition.tsx"
      provides: "Updated composition using VideoTemplate"
      contains: "VideoTemplate"
  key_links:
    - from: "backend/src/compositions/HookComposition.tsx"
      to: "backend/src/compositions/VideoTemplate.tsx"
      via: "import VideoTemplate"
      pattern: "import.*VideoTemplate"
    - from: "backend/src/compositions/VideoTemplate.tsx"
      to: "backend/src/compositions/themes/themeConfig.ts"
      via: "useTheme hook"
      pattern: "useTheme"
---

<objective>
Create base 9:16 video template with theme integration.

**Purpose:** Implement the foundational video template component that renders vertical video format (1080x1920, 30fps) with theme-based styling system.

**Output:** Working VideoTemplate component with 9:16 format, theme configuration object, updated HookComposition using the template.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-video-generation-backend/04-CONTEXT.md
@.planning/phases/04-video-generation-backend/04-RESEARCH.md

# Prior work
- 04-01: Backend setup, HookComposition stub with Zod schema created

# Research references
- Video format: 9:16 (1080x1920), 30fps, H.264 + AAC
- Theme system: KiraPop, MonoEdge, ZenWa with colors, fonts, animations
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create theme configuration system</name>
  <files>backend/src/compositions/themes/themeConfig.ts</files>
  <action>
Create **backend/src/compositions/themes/themeConfig.ts**:

```typescript
import {z} from 'zod';

export const themeSchema = z.object({
  theme: z.enum(['KiraPop', 'MonoEdge', 'ZenWa']),
  tone: z.enum(['TikTok', 'YouTube', 'Instagram']),
});

export type VideoTheme = z.infer<typeof themeSchema>;

export interface ThemeConfig {
  colors: {
    background: string;
    primary: string;
    text: string;
    accent: string;
  };
  fonts: {
    heading: string;
    body: string;
  };
  animations: {
    spring: {damping: number; stiffness: number};
    typingSpeed: number;
  };
}

export const themeConfig: Record<VideoTheme['theme'], ThemeConfig> = {
  KiraPop: {
    colors: {
      background: '#FFB6C1',
      primary: '#FF69B4',
      text: '#FFFFFF',
      accent: '#87CEEB',
    },
    fonts: {
      heading: 'M PLUS Rounded 1c, sans-serif',
      body: 'Noto Sans JP, sans-serif',
    },
    animations: {
      spring: {damping: 15, stiffness: 200},
      typingSpeed: 20,
    },
  },
  MonoEdge: {
    colors: {
      background: '#1A1A1A',
      primary: '#FFFFFF',
      text: '#E0E0E0',
      accent: '#00FFFF',
    },
    fonts: {
      heading: 'Noto Sans JP, sans-serif',
      body: 'Noto Sans JP, sans-serif',
    },
    animations: {
      spring: {damping: 50, stiffness: 100},
      typingSpeed: 15,
    },
  },
  ZenWa: {
    colors: {
      background: '#F5F5DC',
      primary: '#8B4513',
      text: '#2F2F2F',
      accent: '#DAA520',
    },
    fonts: {
      heading: 'Noto Serif JP, serif',
      body: 'Noto Serif JP, serif',
    },
    animations: {
      spring: {damping: 30, stiffness: 80},
      typingSpeed: 12,
    },
  },
};

export const useTheme = (themeName: VideoTheme['theme']): ThemeConfig => {
  return themeConfig[themeName];
};
```

Why:
- themeConfig.ts defines TypeScript interface and configuration object
- Three themes match Phase 3 mobile app designs (KiraPop: vibrant pink, MonoEdge: monochrome, ZenWa: forest brown)
- Colors, fonts, animations exported for use in video templates

Reference:
- Phase 3 themes (STATE.md decisions)
- Video format: 9:16 (1080x1920), 30fps (04-CONTEXT.md)
  </action>
  <verify>
```bash
cd backend && grep -n "export const themeConfig" src/compositions/themes/themeConfig.ts
cd backend && grep -n "KiraPop.*#FF69B4" src/compositions/themes/themeConfig.ts
cd backend && grep -n "useTheme" src/compositions/themes/themeConfig.ts
```
  </verify>
  <done>
backend/src/compositions/themes/themeConfig.ts exports themeConfig with KiraPop, MonoEdge, ZenWa
Each theme has colors (background, primary, text, accent), fonts (heading, body), animations (spring, typingSpeed)
useTheme hook function exported for accessing theme configuration
  </done>
</task>

<task type="auto">
  <name>Task 2: Create VideoTemplate base component</name>
  <files>backend/src/compositions/VideoTemplate.tsx</files>
  <action>
Create **backend/src/compositions/VideoTemplate.tsx**:

```typescript
import React from 'react';
import {AbsoluteFill} from 'remotion';
import {useTheme} from './themes/themeConfig';

interface VideoTemplateProps {
  theme: 'KiraPop' | 'MonoEdge' | 'ZenWa';
  children: React.ReactNode;
}

export const VideoTemplate: React.FC<VideoTemplateProps> = ({
  theme,
  children,
}) => {
  const themeConfig = useTheme(theme);

  return (
    <AbsoluteFill
      style={{
        backgroundColor: themeConfig.colors.background,
        color: themeConfig.colors.text,
        fontFamily: themeConfig.fonts.body,
        display: 'flex',
        flexDirection: 'column',
        width: '100%',
        height: '100%',
      }}
    >
      {children}
    </AbsoluteFill>
  );
};
```

Update **backend/src/compositions/HookComposition.tsx** to use VideoTemplate:

```typescript
import React from 'react';
import {AbsoluteFill} from 'remotion';
import {z} from 'zod';
import {VideoTemplate} from './VideoTemplate';

export const hookCompositionSchema = z.object({
  nickname: z.string().max(20),
  fortuneData: z.object({
    result: z.string().max(200),
    rating: z.number().min(1).max(5),
  }),
  theme: z.enum(['KiraPop', 'MonoEdge', 'ZenWa']),
  tone: z.enum(['TikTok', 'YouTube', 'Instagram']),
});

interface HookCompositionProps {
  nickname: string;
  fortuneData: {
    result: string;
    rating: number;
  };
  theme: 'KiraPop' | 'MonoEdge' | 'ZenWa';
  tone: 'TikTok' | 'YouTube' | 'Instagram';
}

export const HookComposition: React.FC<HookCompositionProps> = ({
  nickname,
  fortuneData,
  theme,
}) => {
  return (
    <VideoTemplate theme={theme}>
      <AbsoluteFill>
        <div style={{
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          fontSize: 48,
          textAlign: 'center',
          padding: 40,
        }}>
          {nickname}さんの{theme}テーマ動画
        </div>
      </AbsoluteFill>
    </VideoTemplate>
  );
};
```

Why:
- VideoTemplate provides themed container with AbsoluteFill (Remotion's full-screen component)
- HookComposition wraps content in VideoTemplate to apply theme-specific styling
- Component structure ready for adding Sequence-based sections in next plan

Reference:
- AbsoluteFill for full-screen container (Remotion standard pattern)
- 9:16 format configured in index.ts (1080x1920, 30fps)
- Theme system from themeConfig.ts
  </action>
  <verify>
```bash
cd backend && grep -n "export const VideoTemplate" src/compositions/VideoTemplate.tsx
cd backend && grep -n "AbsoluteFill" src/compositions/VideoTemplate.tsx
cd backend && grep -n "VideoTemplate" src/compositions/HookComposition.tsx
```
  </verify>
  <done>
backend/src/compositions/VideoTemplate.tsx exports VideoTemplate component with AbsoluteFill wrapper
VideoTemplate uses theme prop to style background, color, fontFamily via useTheme hook
HookComposition updated to use VideoTemplate wrapper instead of stub implementation
  </done>
</task>

</tasks>

<verification>
After completing all tasks, verify:

1. **TypeScript compilation:**
```bash
cd backend && npx tsc --noEmit
```

2. **Theme exports exist:**
```bash
cd backend && grep -r "export" src/compositions/themes/
```

3. **VideoTemplate is used:**
```bash
cd backend && grep -r "VideoTemplate" src/compositions/
```
</verification>

<success_criteria>
Phase 04-02 is complete when:
- backend/src/compositions/themes/themeConfig.ts exists with themeConfig object (KiraPop, MonoEdge, ZenWa)
- backend/src/compositions/VideoTemplate.tsx exports VideoTemplate component with AbsoluteFill
- VideoTemplate uses useTheme hook to apply theme-specific styling (colors, fonts)
- HookComposition imports and uses VideoTemplate wrapper
- All files pass TypeScript compilation
</success_criteria>

<output>
After completion, create `.planning/phases/04-video-generation-backend/04-02-SUMMARY.md`
</output>
