---
phase: 05-video-content-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/src/compositions/HookComposition.tsx
  - backend/src/compositions/sections/NicknameSection.tsx
  - backend/src/compositions/sections/TransitionEffect.tsx
autonomous: true

must_haves:
  truths:
    - "User's nickname appears dynamically in the video during 2-5s section"
    - "Nickname is displayed with typing animation effect"
    - "Nickname prop is passed through composition and rendered correctly"
    - "Video rendering completes without errors when nickname is provided"
  artifacts:
    - path: "backend/src/compositions/sections/NicknameSection.tsx"
      provides: "Nickname typing display component"
      exports: ["NicknameSection"]
      min_lines: 30
    - path: "backend/src/compositions/sections/TransitionEffect.tsx"
      provides: "Section transition animations"
      exports: ["TransitionEffect"]
      min_lines: 25
    - path: "backend/src/compositions/HookComposition.tsx"
      provides: "Updated composition with nickname integration"
      contains: "NicknameSection"
  key_links:
    - from: "backend/src/compositions/HookComposition.tsx"
      to: "backend/src/compositions/sections/NicknameSection.tsx"
      via: "import statement and component usage"
      pattern: "import.*NicknameSection"
    - from: "backend/src/api/controllers/renderController.ts"
      to: "backend/src/compositions/HookComposition.tsx"
      via: "inputProps.nickname"
      pattern: "inputProps.*nickname"
---

<objective>
Integrate dynamic nickname insertion into video composition with typing animation and transition effects

**Purpose**: Enable personalized video content where the user's nickname appears with character-by-character typing effect during the personalization section (2-5s)

**Output**:
- NicknameSection component with typing animation
- TransitionEffect component for section transitions
- Updated HookComposition with nickname integration
- Working nickname display in generated videos
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-video-generation-backend/04-03-SUMMARY.md
@.planning/phases/04-video-generation-backend/04-04-SUMMARY.md
@backend/src/compositions/HookComposition.tsx
@backend/src/compositions/TypingText.tsx
@mobile/src/components/cards/FamilyCard.tsx
@mobile/src/components/cards/LoveCard.tsx
@mobile/src/components/cards/WorkCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create NicknameSection component with typing animation</name>
  <files>backend/src/compositions/sections/NicknameSection.tsx</files>
  <action>
Create a new NicknameSection component that:
- Accepts `nickname` (string) and `speed` (number) props
- Uses existing TypingText component from backend/src/compositions/TypingText.tsx
- Renders with position: absolute at top: 30%, left: 50%, transform: translateX(-50%)
- Displays nickname with "さんの運勢" suffix (e.g., "テストユーザーさんの運勢")
- Uses fontSize: 48, fontWeight: bold, color: themeConfig.colors.primary
- Width: 80%, textAlign: center for proper centering

File location: backend/src/compositions/sections/NicknameSection.tsx

Import TypingText from '../TypingText' (relative path)

IMPORTANT: This component is a wrapper around TypingText with specific positioning and styling for the nickname section. Do NOT recreate TypingText functionality - import and use it.
  </action>
  <verify>
File exists at backend/src/compositions/sections/NicknameSection.tsx with:
- NicknameSection component exported
- TypingText import from '../TypingText'
- nickname and speed props
- Proper positioning and styling
  </verify>
  <done>
NicknameSection component created with typing animation using existing TypingText component
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TransitionEffect component for section transitions</name>
  <files>backend/src/compositions/sections/TransitionEffect.tsx</files>
  <action>
Create a TransitionEffect component that provides smooth visual transitions between video sections:
- Accepts `trigger` prop (boolean or number) to control when transition plays
- Uses Remotion's useCurrentFrame() and interpolate() for smooth animations
- Provides fade-in/fade-out effect with configurable duration
- Default duration: 30 frames (1 second at 30fps)
- Export opacity value that can be applied to child elements via style prop

Component signature:
```typescript
interface TransitionEffectProps {
  trigger: boolean | number;
  duration?: number; // frames, default 30
  type?: 'fade' | 'slide' | 'scale'; // default 'fade'
}

export const TransitionEffect: React.FC<TransitionEffectProps> = ({ trigger, duration = 30, type = 'fade' }) => {
  // Returns { opacity, transform } values for child elements
}
```

File location: backend/src/compositions/sections/TransitionEffect.tsx

NOTE: This is a utility component. It does NOT render JSX directly. It returns style values that parent components apply.
  </action>
  <verify>
File exists at backend/src/compositions/sections/TransitionEffect.tsx with:
- TransitionEffect component exported
- useCurrentFrame() hook usage
- interpolate() for animation calculations
- Returns style object with opacity/transform values
  </verify>
  <done>
TransitionEffect component created with fade/slide/scale animation utilities
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate NicknameSection into HookComposition</name>
  <files>backend/src/compositions/HookComposition.tsx</files>
  <action>
Update HookComposition.tsx to use the new NicknameSection:

1. Add import at top:
```typescript
import {NicknameSection} from './sections/NicknameSection';
```

2. Replace the existing 2-5s Sequence (currently at lines 54-74) with NicknameSection:
```typescript
{/* 2-5s (90 frames): Personalization - nickname typing */}
<Sequence from={60} durationInFrames={90}>
  <NicknameSection
    nickname={nickname}
    speed={themeConfig.animations.typingSpeed}
  />
</Sequence>
```

3. Keep all other sections unchanged (0-2s visual hook, 5-15s revelation, 15-20s CTA, 20-30s branding)

4. Verify nickname prop flows from HookCompositionProps -> NicknameSection

IMPORTANT: Only modify the 2-5s section. Do NOT change other sections or the overall composition structure.
  </action>
  <verify>
- HookComposition.tsx imports NicknameSection
- 2-5s Sequence uses NicknameSection component
- nickname prop passed to NicknameSection
- Other sections remain unchanged
- TypeScript compilation passes with no errors
  </verify>
  <done>
HookComposition updated to use NicknameSection for dynamic nickname display with typing animation
  </done>
</task>

</tasks>

<verification>
Overall phase verification:

1. **Component Structure Check**:
```bash
ls -la backend/src/compositions/sections/
# Should show: NicknameSection.tsx, TransitionEffect.tsx
```

2. **TypeScript Compilation**:
```bash
cd backend
npx tsc --noEmit
# Should complete without errors
```

3. **Import Verification**:
```bash
grep -n "import.*NicknameSection" backend/src/compositions/HookComposition.tsx
# Should show import statement
grep -n "NicknameSection" backend/src/compositions/HookComposition.tsx
# Should show component usage in 2-5s Sequence
```

4. **Schema Validation**:
HookComposition should still accept hookCompositionSchema with nickname field (already exists in Phase 04-03)
</verification>

<success_criteria>
Success criteria met when:
- [ ] NicknameSection component exists and uses TypingText
- [ ] TransitionEffect component exists with animation utilities
- [ ] HookComposition imports and uses NicknameSection in 2-5s section
- [ ] TypeScript compilation passes without errors
- [ ] Nickname prop flows correctly from API -> composition -> display
- [ ] No changes to other sections (0-2s, 5-15s, 15-20s, 20-30s)
</success_criteria>

<output>
After completion, create `.planning/phases/05-video-content-integration/05-01-SUMMARY.md`
</output>
