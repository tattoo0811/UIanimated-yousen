---
phase: 03-design-system
plan: 02
type: execute
wave: 2
depends_on: [03-01]
files_modified:
  - mobile/src/themes/themes/kiraPop.ts
  - mobile/src/themes/themes/monoEdge.ts
  - mobile/src/themes/themes/zenWa.ts
  - mobile/src/themes/index.ts
  - mobile/src/themes/fonts.ts
  - mobile/src/components/ThemeCard.tsx
  - mobile/src/components/ThemePicker.tsx
  - mobile/app/settings.tsx
  - mobile/src/components/SwipeableStack.tsx
  - mobile/package.json
autonomous: true

must_haves:
  truths:
    - "3 themes (KiraPop, MonoEdge, ZenWa) defined with unique colors, fonts, animations"
    - "User can select theme from settings screen"
    - "Theme selection persists across app restarts"
    - "Theme applies immediately when selected (real-time preview)"
    - "SwipeableStack uses theme-specific animation configs"
  artifacts:
    - path: "mobile/src/themes/themes/kiraPop.ts"
      provides: "KiraPop theme config (vibrant, playful, 10-20s demographic)"
      contains: "colors.light.primary: '#FF6B9D'"
    - path: "mobile/src/themes/themes/monoEdge.ts"
      provides: "MonoEdge theme config (monochrome, modern, 30-40s demographic)"
      contains: "colors.light.primary: '#1A1A1A'"
    - path: "mobile/src/themes/themes/zenWa.ts"
      provides: "ZenWa theme config (Japanese elegant, serene, 50s+ demographic)"
      contains: "colors.light.primary: '#2D5016'"
    - path: "mobile/src/components/ThemeCard.tsx"
      provides: "Theme preview card component"
    - path: "mobile/src/components/ThemePicker.tsx"
      provides: "Swipeable theme selection using SwipeableStack"
    - path: "mobile/app/settings.tsx"
      provides: "Settings screen with theme selection section"
  key_links:
    - from: "mobile/src/themes/index.ts"
      to: "mobile/src/themes/themes/kiraPop.ts"
      via: "import { kiraPopTheme }"
      pattern: "kiraPopTheme"
    - from: "mobile/src/components/ThemePicker.tsx"
      to: "mobile/src/hooks/useTheme.ts"
      via: "const { themeId, setTheme } = useTheme()"
      pattern: "setTheme"
    - from: "mobile/app/settings.tsx"
      to: "mobile/src/components/ThemePicker.tsx"
      via: "import { ThemePicker }"
      pattern: "ThemePicker"
    - from: "mobile/src/components/SwipeableStack.tsx"
      to: "mobile/src/hooks/useTheme.ts"
      via: "const { theme } = useTheme()"
      pattern: "theme.animations"
---

<objective>
Three Theme Implementations with Settings UI — Create KiraPop, MonoEdge, ZenWa themes with unique colors/fonts/animations, install font packages, add theme selection UI to settings, integrate theme-based animations into SwipeableStack
Purpose: Deliver complete multi-theme experience targeting different age demographics with unique visual identities
Output: Working theme system with 3 selectable themes, real-time preview, persistent selection
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md

@.planning/phases/03-design-system/03-CONTEXT.md
@.planning/phases/03-design-system/03-RESEARCH.md
@.planning/ROADMAP.md
@.planning/PROJECT.md
@.planning/phases/03-design-system/03-01-PLAN.md

@mobile/src/components/SwipeableStack.tsx
@mobile/lib/animations.ts
@mobile/app/settings.tsx
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/03-design-system/03-01-SUMMARY.md
@.planning/phases/02-card-ui-core/02-03-SUMMARY.md
@.planning/phases/02-card-ui-core/02-04-SUMMARY.md

@mobile/src/contexts/ThemeContext.tsx
@mobile/src/hooks/useTheme.ts
@mobile/src/hooks/useHapticFeedback.ts
@mobile/src/themes/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Google Font packages</name>
  <files>mobile/package.json</files>
  <action>
Install the three Google Font packages needed for the themes:

```bash
cd mobile && npm install --save-exact @expo-google-fonts/m-plus-rounded-1c @expo-google-fonts/noto-sans-jp @expo-google-fonts/noto-serif-jp
```

These packages provide:
- M PLUS Rounded 1c: Rounded font for KiraPop (playful, youth-oriented)
- Noto Sans JP: Clean sans-serif for MonoEdge (modern, professional)
- Noto Serif JP: Elegant serif for ZenWa (traditional, refined)

All fonts use SIL Open Font License (OFL) - free for commercial use without restrictions.
  </action>
  <verify>
grep -q "@expo-google-fonts/m-plus-rounded-1c" mobile/package.json && grep -q "@expo-google-fonts/noto-sans-jp" mobile/package.json && grep -q "@expo-google-fonts/noto-serif-jp" mobile/package.json
  </verify>
  <done>
Three @expo-google-fonts packages installed in package.json
  </done>
</task>

<task type="auto">
  <name>Task 2: Create KiraPop theme (vibrant, playful, 10-20s)</name>
  <files>mobile/src/themes/themes/kiraPop.ts</files>
  <action>
Create mobile/src/themes/themes/kiraPop.ts:

1. Import Theme type from '../types'

2. Export kiraPopTheme: Theme with:

**id**: 'kiraPop'

**name**: { en: 'KiraPop', ja: 'キラポップ' }

**description**: { en: 'Vibrant & Playful', ja: 'キラキラポップで楽しく' }

**colors.light**:
- primary: '#FF6B9D' (vivid pink)
- secondary: '#00D9FF' (cyan)
- accent: '#FFED47' (yellow)
- background: '#FFF5F8' (light pinkish cream)
- surface: '#FFFFFF' (pure white)
- text: '#2D2D2D' (dark gray)
- textSecondary: '#6B6B6B' (medium gray)

**colors.dark**:
- primary: '#FF6B9D' (same)
- secondary: '#00D9FF'
- accent: '#FFED47'
- background: '#1A1020' (deep purplish black)
- surface: '#2D1A30' (purplish dark gray)
- text: '#FFFFFF'
- textSecondary: '#B8B8B8'

**fonts**:
- regular: 'MPlusRounded1c_400Regular'
- bold: 'MPlusRounded1c_700Bold'

**animations.spring**: { damping: 12, stiffness: 400, mass: 0.8 } (bouncy)
**animations.timing**: { duration: 300 }
**animations.swipe**: { maxRotation: 20, scaleAmount: 1.15, fadeSpeed: 0.7 }
  </action>
  <verify>
grep -q "kiraPopTheme" mobile/src/themes/themes/kiraPop.ts && grep -q "#FF6B9D" mobile/src/themes/themes/kiraPop.ts && grep -q "MPlusRounded1c" mobile/src/themes/themes/kiraPop.ts
  </verify>
  <done>
kiraPop.ts exports theme with pink/cyan/yellow colors, rounded font, bouncy animations
  </done>
</task>

<task type="auto">
  <name>Task 3: Create MonoEdge theme (monochrome, modern, 30-40s)</name>
  <files>mobile/src/themes/themes/monoEdge.ts</files>
  <action>
Create mobile/src/themes/themes/monoEdge.ts:

1. Import Theme type from '../types'

2. Export monoEdgeTheme: Theme with:

**id**: 'monoEdge'

**name**: { en: 'MonoEdge', ja: 'モノエッジ' }

**description**: { en: 'Modern & Cool', ja: 'クールでモダンに' }

**colors.light**:
- primary: '#1A1A1A' (black)
- secondary: '#4A4A4A' (dark gray)
- accent: '#6366F1' (indigo)
- background: '#FAFAFA' (off-white)
- surface: '#FFFFFF'
- text: '#1A1A1A'
- textSecondary: '#6B7280'

**colors.dark**:
- primary: '#FFFFFF' (white)
- secondary: '#A1A1AA' (light gray)
- accent: '#818CF8' (lighter indigo)
- background: '#0A0A0A' (deepest black)
- surface: '#171717'
- text: '#FFFFFF'
- textSecondary: '#A1A1AA'

**fonts**:
- regular: 'NotoSansJP_400Regular'
- bold: 'NotoSansJP_700Bold'

**animations.spring**: { damping: 25, stiffness: 300, mass: 1.0 } (smooth)
**animations.timing**: { duration: 350 }
**animations.swipe**: { maxRotation: 12, scaleAmount: 1.05, fadeSpeed: 0.85 }
  </action>
  <verify>
grep -q "monoEdgeTheme" mobile/src/themes/themes/monoEdge.ts && grep -q "#1A1A1A" mobile/src/themes/themes/monoEdge.ts && grep -q "NotoSansJP" mobile/src/themes/themes/monoEdge.ts
  </verify>
  <done>
monoEdge.ts exports theme with monochrome colors, Noto Sans font, smooth animations
  </done>
</task>

<task type="auto">
  <name>Task 4: Create ZenWa theme (Japanese elegant, serene, 50s+)</name>
  <files>mobile/src/themes/themes/zenWa.ts</files>
  <action>
Create mobile/src/themes/themes/zenWa.ts:

1. Import Theme type from '../types'

2. Export zenWaTheme: Theme with:

**id**: 'zenWa'

**name**: { en: 'ZenWa', ja: 'ゼンワ' }

**description**: { en: 'Elegant & Serene', ja: '和の心で上品に' }

**colors.light**:
- primary: '#2D5016' (deep forest green)
- secondary: '#8B7355' (earthy brown)
- accent: '#C77D63' (akane/madder red - traditional Japanese color)
- background: '#F5F1E8' (kinari-iro - natural cream)
- surface: '#FAF6EF' (light cream)
- text: '#2D2D2D'
- textSecondary: '#6B6B6B'

**colors.dark**:
- primary: '#7DA869' (lighter green for visibility)
- secondary: '#A89070'
- accent: '#D9947A'
- background: '#1A1A14' (warm black with brown hint)
- surface: '#242018' (warm dark gray)
- text: '#F5F1E8' (cream for comfort)
- textSecondary: '#B8B8B8'

**fonts**:
- regular: 'NotoSerifJP_400Regular'
- bold: 'NotoSerifJP_700Bold'

**animations.spring**: { damping: 30, stiffness: 200, mass: 1.2 } (gentle)
**animations.timing**: { duration: 450 }
**animations.swipe**: { maxRotation: 8, scaleAmount: 1.02, fadeSpeed: 1.0 }
  </action>
  <verify>
grep -q "zenWaTheme" mobile/src/themes/themes/zenWa.ts && grep -q "#2D5016" mobile/src/themes/themes/zenWa.ts && grep -q "NotoSerifJP" mobile/src/themes/themes/zenWa.ts
  </verify>
  <done>
zenWa.ts exports theme with forest green/brown/akane colors, Noto Serif font, gentle animations
  </done>
</task>

<task type="auto">
  <name>Task 5: Update themes index and create fonts configuration</name>
  <files>mobile/src/themes/index.ts, mobile/src/themes/fonts.ts</files>
  <action>
1. Update mobile/src/themes/index.ts:
   - Import kiraPopTheme, monoEdgeTheme, zenWaTheme from './themes/*'
   - Export themes object: { kiraPop: kiraPopTheme, monoEdge: monoEdgeTheme, zenWa: zenWaTheme }
   - Export allThemes array: [kiraPopTheme, monoEdgeTheme, zenWaTheme]
   - Remove placeholder from 03-01

2. Create mobile/src/themes/fonts.ts:
   - Create useThemeFonts hook using expo-font's useFonts
   - Import all 6 font variants:
     * MPlusRounded1c_400Regular, MPlusRounded1c_700Bold
     * NotoSansJP_400Regular, NotoSansJP_700Bold
     * NotoSerifJP_400Regular, NotoSerifJP_700Bold
   - Return fontsLoaded boolean
   - Export font names as constants for type safety

Fonts must load before app renders to prevent layout shifts (pitfall #2).
  </action>
  <verify>
grep -q "kiraPopTheme" mobile/src/themes/index.ts && grep -q "useThemeFonts" mobile/src/themes/fonts.ts && npx tsc --noEmit --skipLibCheck
  </verify>
  <done>
themes/index.ts exports themes object with all 3 themes; fonts.ts provides useThemeFonts hook
  </done>
</task>

<task type="auto">
  <name>Task 6: Create ThemeCard component</name>
  <files>mobile/src/components/ThemeCard.tsx</files>
  <action>
Create mobile/src/components/ThemeCard.tsx:

1. Props interface: theme: Theme, onPress: () => void, isActive?: boolean

2. Component uses useTheme hook to get current themeId

3. Card displays:
   - Theme preview rectangle using theme's colors (gradient of primary/secondary)
   - Theme name in theme's font (ja)
   - Theme description in theme's font
   - Active indicator if this theme is selected
   - Sample text showing theme's typography

4. Styling:
   - Width: ~280px
   - Rounded corners (2xl)
   - Shadow/elevation
   - Border highlight when active

5. Use TouchableOpacity for press feedback

6. Use useHapticFeedback().selection() on press

The card serves as both preview and selector for the theme.
  </action>
  <verify>
grep -q "ThemeCard" mobile/src/components/ThemeCard.tsx && grep -q "useTheme" mobile/src/components/ThemeCard.tsx && npx tsc --noEmit --skipLibCheck
  </verify>
  <done>
ThemeCard.tsx renders theme preview card with colors, fonts, and active state
  </done>
</task>

<task type="auto">
  <name>Task 7: Create ThemePicker swipeable component</name>
  <files>mobile/src/components/ThemePicker.tsx</files>
  <action>
Create mobile/src/components/ThemePicker.tsx:

1. Import SwipeableStack, ThemeCard, useTheme, useHapticFeedback

2. Props interface: onThemeSelect?: (themeId: ThemeId) => void

3. Component:
   - Get current themeId and setTheme from useTheme
   - Get success haptic from useHapticFeedback
   - Map themes to SwipeableStack-compatible format (Theme -> {id, name, ...})
   - Render SwipeableStack with theme cards
   - onSelect handler: calls setTheme + onThemeSelect callback + success() haptic

4. Integration:
   - SwipeableStack handles the card swiping interaction
   - Right swipe on theme card applies that theme
   - Immediate theme change via setTheme

5. Header/label: "テーマを選択" with theme-aware styling

Reuses SwipeableStack from Phase 2 for consistent UX.
  </action>
  <verify>
grep -q "ThemePicker" mobile/src/components/ThemePicker.tsx && grep -q "SwipeableStack" mobile/src/components/ThemePicker.tsx && npx tsc --noEmit --skipLibCheck
  </verify>
  <done>
ThemePicker.tsx provides swipeable theme selection using SwipeableStack
  </done>
</task>

<task type="auto">
  <name>Task 8: Integrate theme selection into settings screen</name>
  <files>mobile/app/settings.tsx</files>
  <action>
Update mobile/app/settings.tsx:

1. Import ThemePicker from '@/src/components/ThemePicker'

2. Add new section "テーマ選択" (Theme Selection) after Premium Status section, before Usage Stats

3. Section styling:
   - Background card matching existing settings sections (bg-surface-dark)
   - Rounded corners (2xl)
   - Padding (p-6)
   - Margin bottom (mb-6)

4. Description text: "スワイプしてテーマを選択" (Swipe to select theme)

5. Render ThemePicker component

6. Ensure theme-aware styling using useTheme hook for text colors

Theme selection is added without removing existing settings functionality.
  </action>
  <verify>
grep -q "ThemePicker" mobile/app/settings.tsx && grep -q "テーマ" mobile/app/settings.tsx
  </verify>
  <done>
settings.tsx includes ThemePicker section for theme selection
  </done>
</task>

<task type="auto">
  <name>Task 9: Integrate theme animations into SwipeableStack</name>
  <files>mobile/src/components/SwipeableStack.tsx</files>
  <action>
Update mobile/src/components/SwipeableStack.tsx to use theme-based animations:

1. Import useTheme hook

2. Get theme.animations config: const { theme } = useTheme()

3. Replace SWIPE_CONFIG references with theme-specific values:
   - spring config: theme.animations.spring (damping, stiffness, mass)
   - swipe config: theme.animations.swipe (maxRotation, scaleAmount, fadeSpeed)
   - timing: theme.animations.timing.duration

4. Modify swipe gesture handlers to use theme.config values:
   - withSpring(SCREEN_WIDTH * 2, theme.animations.spring, ...)
   - Rotation interpolation uses theme.animations.swipe.maxRotation
   - Next card scale uses theme.animations.swipe.scaleAmount
   - Next card opacity uses theme.animations.swipe.fadeSpeed

5. Keep fallback to SWIPE_CONFIG if theme not available (defensive coding)

This makes swipe animations feel different per theme:
- KiraPop: bouncy, exaggerated rotation/scale
- MonoEdge: smooth, moderate effects
- ZenWa: gentle, minimal effects

Note: ZodiacCard colors don't change yet - full component theming is future work.
  </action>
  <verify>
grep -q "useTheme" mobile/src/components/SwipeableStack.tsx && grep -q "theme.animations" mobile/src/components/SwipeableStack.tsx && npx tsc --noEmit --skipLibCheck
  </verify>
  <done>
SwipeableStack uses theme-specific spring, rotation, scale, and fade configs
  </done>
</task>

</tasks>

<verification>
1. All theme files exist and export correctly
2. Font packages installed in package.json
3. ThemePicker renders in settings screen
4. Theme selection persists after app restart
5. SwipeableStack animation changes based on selected theme
6. Type checking passes: `npx tsc --noEmit --skipLibCheck`
</verification>

<success_criteria>
1. 3 themes (KiraPop, MonoEdge, ZenWa) implemented with unique colors/fonts/animations
2. User can select theme via settings screen with swipeable cards
3. Theme selection persists across app restarts via AsyncStorage
4. Theme applies immediately when selected (real-time preview)
5. SwipeableStack animations reflect current theme's animation profile
6. Success Criteria from ROADMAP all met:
   - SC1: User can select from 3+ design themes
   - SC2: Each theme has consistent colors, fonts, animations
   - SC3: Theme switching reflects immediately
   - SC4: Settings persist across app restarts
</success_criteria>

<output>
After completion, create `.planning/phases/03-design-system/03-02-SUMMARY.md`
</output>
