---
phase: 02-card-ui-core
plan: 03
type: execute
wave: 1
depends_on:
  - 02-01
  - 02-02
files_modified:
  - mobile/app/zodiac-select.tsx
  - mobile/src/components/SwipeableStack.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "ユーザーはスワイプでカードを切り替えできる"
    - "アプリ内の画面からスワイプ可能なカード一覧にアクセスできる"
  artifacts:
    - path: "mobile/app/zodiac-select.tsx"
      provides: "SwipeableStackを使用した干支選択画面"
      exports: ["default (ZodiacSelectScreen)"]
      min_lines: 40
  key_links:
    - from: "mobile/app/zodiac-select.tsx"
      to: "mobile/src/components/SwipeableStack.tsx"
      via: "import { SwipeableStack } from '@/src/components/SwipeableStack'"
      pattern: "SwipeableStack"
    - from: "mobile/app/zodiac-select.tsx"
      to: "mobile/src/lib/zodiac"
      via: "import { ZODIAC_SIGNS } from '@/src/lib/zodiac'"
      pattern: "ZODIAC_SIGNS"
    - from: "mobile/src/components/SwipeableStack.tsx"
      to: "mobile/app/fortune/[sign].tsx"
      via: "onSelect handler navigation"
      pattern: "router.push.*fortune"
---

# Plan 02-03: 干支選択画面の作成とSwipeableStack統合

## Objective

SwipeableStackコンポーネントを統合した干支選択画面を作成する。これにより、ユーザーはスワイプ操作で12の干支カードを閲覧・選択できるようになる。

## Context

### ギャップ分析
VERIFICATION.mdより:
- **問題**: SwipeableStackコンポーネント（184行）が実装されているが、アプリ画面からインポート・使用されていない
- **原因**: 02-01, 02-02プランではコンポーネント実装のみを行い、画面統合を行わなかった
- **影響**: ユーザーはスワイプ可能なカードUIを体験できない

### 既存のアーティファクト
- `mobile/src/components/SwipeableStack.tsx` - スワイプ可能なカードスタック（完成済み）
- `mobile/src/components/ZodiacCard.tsx` - タップアニメーション付きカード（完成済み）
- `mobile/src/lib/zodiac.ts` - ZODIAC_SIGNSデータ配列（12干支）
- `mobile/app/fortune/[sign].tsx` - 干支詳細画面（遷移先）

### 技術スタック
- Expo Router - ファイルベースルーティング
- react-native-reanimated - UIスレッドアニメーション
- react-native-gesture-handler - ジェスチャー検出

## Success Criteria (must_haves)

1. [ ] `/zodiac-select` 画面にアクセスすると、スワイプ可能なカードが表示される
2. [ ] 12個の干支カードが順番に表示される
3. [ ] 右スワイプで選択すると `/fortune/{signId}` に遷移する
4. [ ] 左スワイプでスキップすると次カードが表示される
5. [ ] スワイプ時に60fpsのアニメーションが動作する

## Tasks

### Task 1: 干支選択画面の作成

SwipeableStackコンポーネントを使用した干支選択画面を作成する。

**ファイル:** `mobile/app/zodiac-select.tsx` (新規作成)

```typescript
import { View, StyleSheet } from 'react-native';
import { useRouter } from 'expo-router';
import { SwipeableStack } from '@/src/components/SwipeableStack';
import { ZODIAC_SIGNS, ZodiacSign } from '@/src/lib/zodiac';

export default function ZodiacSelectScreen() {
    const router = useRouter();

    const handleSelect = (sign: ZodiacSign) => {
        // 選択された干支の詳細画面へ遷移
        router.push(`/fortune/${sign.id}`);
    };

    const handleSwipeComplete = (sign: ZodiacSign) => {
        // スワイプ完了時の処理（ analytics等）
        console.log('Swiped:', sign.name);
    };

    return (
        <View style={styles.container}>
            <SwipeableStack
                signs={ZODIAC_SIGNS}
                onSelect={handleSelect}
                onSwipeComplete={handleSwipeComplete}
            />
        </View>
    );
}

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#0f172a', // slate-950
    },
});
```

**検証:**
- [ ] ファイルが作成されている
- [ ] TypeScriptエラーがない
- [ ] SwipeableStackがインポートされている
- [ ] ZODIAC_SIGNSが渡されている

### Task 2: SwipeableStackのスタイル調整

SwipeableStackのコンテナスタイルを画面全体に対応させる。

**ファイル:** `mobile/src/components/SwipeableStack.tsx`

変更内容:
1. 親コンテナの高さをflex-1に変更
2. 画面中央にカードが配置されるように調整

```typescript
// 変更前
return (
    <View className="relative w-full h-[600px] items-center justify-center">

// 変更後
return (
    <View className="relative w-full flex-1 items-center justify-center bg-slate-950">
```

**検証:**
- [ ] 画面全体にカードスタックが表示される
- [ ] カードが画面中央に配置される

### Task 3: ナビゲーションフローの確認

作成した画面にアクセスできることを確認する。

**検証コマンド:**
```bash
cd mobile && npm run typecheck
```

**確認:**
- [ ] 型チェックが通る
- [ ] `/zodiac-select` ルートが有効である

## Verification

実機またはエミュレータで以下を検証:

1. [ ] 画面にアクセスすると、最初の干支カード（Aries）が表示される
2. [ ] 右にスワイプすると、カードが飛び出し、次のカード（Taurus）が表示される
3. [ ] 右スワイプ選択時、`/fortune/aries` 画面に遷移する
4. [ ] 左にスワイプすると、次カードにスキップする
5. [ ] 最後のカード（Pisces）の後、最初のカード（Aries）に戻る（無限ループ）
6. [ ] スワイプ中のアニメーションが滑らかである（60fps）

## Output

完了後、`.planning/phases/02-card-ui-core/02-03-SUMMARY.md` を作成する。
