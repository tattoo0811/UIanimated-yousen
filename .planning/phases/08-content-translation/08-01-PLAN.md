# 08-01: Tone Selection System and Translation Logic

**Phase:** 08 - Content Translation
**Plan:** 1 of 2
**Estimated:** 45 minutes
**Wave:** 1 (Parallel)

## Context

Currently, the backend `contentGenerator.ts` accepts a `tone` parameter but doesn't use it - all content is generated in professional/technical language. Users need a way to select their preferred tone for content translation.

## Success Criteria

1. User can select TikTok/YouTube/Instagram tone from mobile UI
2. Tone selection is persisted to AsyncStorage
3. Backend tone parameter is properly passed through API
4. Content generator accepts tone parameter without errors

## Tasks

### Task 1: Mobile Tone Selection UI (20 min)

**File:** `mobile/src/components/ToneSelector.tsx` (new)

Create a swipeable tone selector component:

```tsx
type ToneType = 'TikTok' | 'YouTube' | 'Instagram';

interface ToneSelectorProps {
  selectedTone: ToneType;
  onToneChange: (tone: ToneType) => void;
}

// UI Requirements:
// - Horizontal swipeable cards
// - Visual preview of each tone style
// - TikTok: pink gradient, "Short & Emotional"
// - YouTube: red gradient, "Story Format"
// - Instagram: gradient, "Visual Focus"
// - haptic feedback on selection
```

**Integration points:**
- Use existing `SwipeableStack.tsx` pattern
- Add to settings screen (`mobile/app/settings.tsx`)
- Persist with AsyncStorage key `@selected_tone`

### Task 2: Backend Tone Type Integration (15 min)

**File:** `backend/src/lib/contentTranslator.ts` (new)

Create translation utility:

```ts
export type ContentTone = 'TikTok' | 'YouTube' | 'Instagram';

export interface TranslationConfig {
  tone: ContentTone;
  maxSentences: number;
  style: 'emotional' | 'storytelling' | 'visual';
}

// Currently pass-through (implement in 08-02)
export function translateToTone(
  content: string,
  config: TranslationConfig
): string {
  // Placeholder - will implement tone patterns in 08-02
  return content;
}
```

**Update:** `backend/src/lib/contentGenerator.ts`

Change all generator functions to use tone:

```ts
export const generateEssenceContent = (
  insen: SanmeigakuInsenChart,
  nickname: string,
  tone: ContentTone  // Now used
): ContentSection => {
  const baseContent = essenceMap[dayStem];
  // TODO: Apply tone translation in 08-02
  return { title, content: baseContent, duration };
};
```

### Task 3: API Integration (10 min)

**File:** `backend/src/api/controllers/renderController.ts`

Update render endpoint to accept tone:

```ts
interface RenderRequest {
  fortuneData: SanmeigakuInsenChart;
  nickname: string;
  theme: string;
  tone: ContentTone;  // Add this
}
```

**File:** `mobile/src/lib/share.ts`

Update video generation call to include tone:

```ts
const generateVideo = async (insen, nickname, theme, tone) => {
  const response = await fetch(`${API_URL}/render`, {
    method: 'POST',
    body: JSON.stringify({ insen, nickname, theme, tone })
  });
};
```

## Dependencies

- Phase 3 (Design System) - complete âœ“
- Existing SwipeableStack pattern
- Existing contentGenerator structure

## Testing Checklist

- [ ] Tone selector renders with 3 options
- [ ] Swipe gesture works with haptic feedback
- [ ] Selected tone persists after app restart
- [ ] Backend accepts tone parameter in API
- [ ] No errors when calling contentGenerator with tone

## Rollback Plan

If tone selector causes issues:
1. Remove from settings screen
2. Default tone to 'TikTok' in API calls
3. Backend can accept tone but ignore until 08-02

## Notes

- This plan creates the STRUCTURE for tone translation
- Actual translation logic happens in 08-02
- Tone selection UI should match existing design system (Phase 3)
- Consider adding tone preview examples in UI
