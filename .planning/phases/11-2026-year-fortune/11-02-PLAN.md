---
phase: 11-2026-year-fortune
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - backend/src/compositions/YearFortuneComposition.tsx
  - backend/src/compositions/themes/themeConfig.ts
  - backend/src/index.tsx
  - mobile/app/(tabs)/fortune.tsx
  - mobile/app/year-fortune.tsx
autonomous: false

must_haves:
  truths:
    - "å¹´é‹å°‚ç”¨ã®Remotionã‚³ãƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã™ã‚‹"
    - "ä¸™åˆè¼ããƒ†ãƒ¼ãƒï¼ˆHeinoE2026ï¼‰ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹"
    - "7ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ§‹æˆã§ä¸™åˆè¦ç´ ãŒæ··ãœè¾¼ã¾ã‚Œã¦ã„ã‚‹"
    - "ã‚­ãƒ©ã‚­ãƒ©ãƒ»è¼ãã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹"
    - "ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã«2026å¹´é‹ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹"
    - "å¹´é‹ãƒšãƒ¼ã‚¸ã‹ã‚‰å‹•ç”»ç”ŸæˆãŒã§ãã‚‹"
  artifacts:
    - path: "backend/src/compositions/YearFortuneComposition.tsx"
      provides: "å¹´é‹å‹•ç”»ã‚³ãƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³"
      exports: ["YearFortuneComposition", "yearFortuneCompositionSchema"]
    - path: "backend/src/compositions/themes/themeConfig.ts"
      provides: "æ‹¡å¼µãƒ†ãƒ¼ãƒè¨­å®š"
      contains: "HeinoE2026"
    - path: "mobile/app/year-fortune.tsx"
      provides: "å¹´é‹å°‚ç”¨ãƒ¢ãƒã‚¤ãƒ«ãƒšãƒ¼ã‚¸"
      min_lines: 100
  key_links:
    - from: "backend/src/index.tsx"
      to: "YearFortuneComposition"
      via: "import and register composition"
    - from: "mobile/app/year-fortune.tsx"
      to: "/api/year-fortune/calculate"
      via: "fetch request"
    - from: "mobile/app/(tabs)/fortune.tsx"
      to: "/year-fortune"
      via: "router.push navigation"
---

<objective>
Create 2026-specialized video template with HeinoE2026 theme and mobile UI integration

Purpose: Generate year fortune videos with ä¸™åˆ-specific visual elements (fire, glow, glitter effects) and provide mobile access to view/share 2026 fortune videos.

Output: YearFortuneComposition with HeinoE2026 theme, mobile year fortune page with navigation button
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-2026-year-fortune/11-CONTEXT.md
@.planning/phases/11-2026-year-fortune/11-RESEARCH.md
@.planning/phases/11-2026-year-fortune/11-01-PLAN.md

# Reference existing composition patterns
@backend/src/compositions/HookComposition.tsx
@backend/src/compositions/CompatibilityComposition.tsx
@backend/src/compositions/themes/themeConfig.ts
@backend/src/compositions/sections/ContentSections.tsx
@backend/src/compositions/TypingText.tsx
@backend/src/compositions/VideoTemplate.tsx

# Reference mobile patterns
@mobile/app/(tabs)/fortune.tsx
@mobile/app/(tabs)/compatibility.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add HeinoE2026 theme to theme config</name>
  <files>backend/src/compositions/themes/themeConfig.ts</files>
  <action>
Extend `backend/src/compositions/themes/themeConfig.ts`:

1. Update themeSchema enum to include 'HeinoE2026':
   - Change: z.enum(['KiraPop', 'MonoEdge', 'ZenWa'])
   - To: z.enum(['KiraPop', 'MonoEdge', 'ZenWa', 'HeinoE2026'])

2. Add HeinoE2026 to themeConfig Record:
   ```typescript
   HeinoE2026: {
     colors: {
       background: '#1A0A0A',  // Dark red-black base
       primary: '#FFD700',      // Gold
       text: '#FFF8E7',         // Cream white
       accent: '#FF4500',       // Fire red-orange
     },
     fonts: {
       heading: 'Noto Serif JP, serif',
       body: 'Noto Sans JP, sans-serif',
     },
     animations: {
       spring: { damping: 20, stiffness: 180 },
       typingSpeed: 18,
     },
   }
   ```

3. Add sparkle/glow effects config (new field for HeinoE2026):
   - Add optional 'glow' field to ThemeConfig interface
   - HeinoE2026 gets: { intensity: 'high', color: '#FFD700', speed: 2 }

4. Update useTheme function signature to accept new theme

The theme represents ä¸™åˆ's fire energy with:
   - Dark background (like ember ashes)
   - Gold primary (wealth/sparkle)
   - Fire red-orange accent (flame)
   - Glow effects enabled
  </action>
  <verify>grep -E "HeinoE2026" backend/src/compositions/themes/themeConfig.ts | wc -l > 3</verify>
  <done>HeinoE2026 theme added with fire/gold color scheme and glow config</done>
</task>

<task type="auto">
  <name>Task 2: Create YearFortuneComposition</name>
  <files>backend/src/compositions/YearFortuneComposition.tsx</files>
  <action>
Create `backend/src/compositions/YearFortuneComposition.tsx` with:

1. **Schema** - yearFortuneCompositionSchema (Zod):
   - nickname: string
   - yearFortune: YearFortuneResult (from types/yearFortune.ts)
   - theme: enum including 'HeinoE2026'
   - tone: TikTok | YouTube | Instagram

2. **Component structure** - Follow HookComposition pattern but with ä¸™åˆ elements:
   - Import: VideoTemplate, TypingText, useTheme, AbsoluteFill, Sequence
   - Import: YearFortuneResult from types/yearFortune.ts
   - 7 sections (same 30-second structure):

     a. Hook (0-3s, 90 frames):
        - "2026å¹´ ä¸™åˆã®é‹å‹¢"
        - Large fire emoji (ğŸ”¥) with scale animation
        - Glow effect using CSS filter: drop-shadow(0 0 20px #FFD700)

     b. Year Intro (3-6s, 90 frames):
        - TypingText: "ä¸™åˆï¼ˆã²ã®ãˆã†ã¾ï¼‰ã®å¹´..."
        - Year data description
        - Sparkle particles (CSS animation)

     c. Compatibility (6-10s, 120 frames):
        - User vs 2026 compatibility score (large number)
        - Relationship label (ç›¸ç”Ÿ/ç›¸å‰‹/åŒäº”è¡Œ)
        - Visual bar for score

     d. Fortune Highlights (10-15s, 150 frames):
        - 3 key highlights from yearFortune.highlights
        - Each appears sequentially with fade-in
        - Fire border glow effect

     e. Detailed Fortune (15-20s, 150 frames):
        - Overall fortune message
        - Love, Work, Health sections (compact)
        - Each section with icon

     f. Advice (20-25s, 150 frames):
        - Main advice message
        - TypingText effect
        - Pulsing glow background

     g. CTA & Branding (25-30s, 150 frames):
        - "ã‚·ã‚§ã‚¢ã—ã¦2026ã‚’é‹æ°—ã‚¢ãƒƒãƒ—ï¼"
        - App branding

3. **Glow/Sparkle Effects**:
   - Create GlowEffect sub-component with CSS keyframes
   - ParticleEffect sub-component for sparkles
   - Use in relevant sections (Hook, Year Intro, Highlights)

4. **Use existing patterns**:
   - TypingText from TypingText.tsx
   - VideoTemplate wrapper
   - themeConfig with HeinoE2026 default
   - Section timing via Sequence from/to/durationInFrames

Default theme to 'HeinoE2026' for this composition
  </action>
  <verify>grep -E "YearFortuneComposition|yearFortuneCompositionSchema|Sequence" backend/src/compositions/YearFortuneComposition.tsx | wc -l > 5</verify>
  <done>Composition exists with 7 sections, glow effects, and ä¸™åˆ-specific content</done>
</task>

<task type="auto">
  <name>Task 3: Register composition and create mobile pages</name>
  <files>backend/src/index.tsx mobile/app/year-fortune.tsx mobile/app/(tabs)/fortune.tsx</files>
  <action>
1. Update `backend/src/index.tsx`:
   - Import YearFortuneComposition
   - Register composition: YearFortune: YearFortuneComposition
   - Follow same pattern as HookComposition, CompatibilityComposition

2. Create `mobile/app/year-fortune.tsx`:
   - Full-screen page for 2026 year fortune
   - Load user's insen data from storage (same as other pages)
   - Call /api/year-fortune/calculate to get fortune data
   - Display:
     * Year overview card (2026 ä¸™åˆ)
     * Compatibility score visual
     * Fortune highlights list
     * Advice section
   - "å‹•ç”»ã‚’ç”Ÿæˆ" button (triggers video generation via API)
   - Loading states during API calls
   - Error handling with user-friendly messages
   - Back navigation to fortune tab

3. Update `mobile/app/(tabs)/fortune.tsx`:
   - Add new "2026å¹´é‹" button in the header area (above the tabs)
   - Button styling:
     * Gold/amber background (#FFD700)
     * Fire icon (ğŸ”¥)
     * "2026å¹´é‹" text
     * Border: 3px solid #333
     * onPress: router.push('/year-fortune')
   - Position: Below header, above existing card, centered
   - Same card-style as "å¹²æ”¯ã‚¹ãƒ¯ã‚¤ãƒ—å ã„" entry card

Follow existing mobile UI patterns:
   - Use fortune.tsx as reference for layout
   - Use compatibility.tsx for API call patterns
   - Use VideoTemplate patterns for button styling
  </action>
  <verify>grep -E "YearFortune" backend/src/index.tsx && grep -E "2026|year-fortune" mobile/app/(tabs)/fortune.tsx && test -f mobile/app/year-fortune.tsx</verify>
  <done>Composition registered, mobile page created, navigation button added to fortune tab</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
  - HeinoE2026 theme with fire/gold colors and glow effects
  - YearFortuneComposition with 7 sections and sparkle effects
  - Mobile year fortune page with API integration
  - 2026å¹´é‹ button in fortune tab
  </what-built>
  <how-to-verify>
  1. Start backend: cd backend && npm run dev
  2. Start mobile: cd mobile && npm run dev
  3. In mobile app, navigate to "é‹å‹¢" tab
  4. Tap "2026å¹´é‹" gold button (should have fire icon)
  5. Verify year fortune page loads:
     - Shows 2026 ä¸™åˆ information
     - Displays compatibility score
     - Shows fortune highlights
     - Has "å‹•ç”»ã‚’ç”Ÿæˆ" button
  6. (Optional) Test video generation endpoint with curl/Postman
  </how-to-verify>
  <resume-signal>Type "approved" if button is visible, page loads correctly, and content displays ä¸™åˆ-specific information. Describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
After implementation (before checkpoint), verify:

1. TypeScript compiles: tsc --noEmit in backend/
2. Theme schema includes HeinoE2026
3. Composition has all 7 sequences with proper frame timing
4. Mobile page has proper error handling and loading states
5. Navigation button is visible in fortune tab
</verification>

<success_criteria>
1. HeinoE2026 theme has gold/fire colors with glow config
2. YearFortuneComposition renders with all 7 sections
3. Glow/sparkle effects are defined and applied
4. /year-fortune page displays year fortune data from API
5. "2026å¹´é‹" button navigates to year fortune page
6. Video generation is triggerable from mobile page
</success_criteria>

<output>
After completion, create `.planning/phases/11-2026-year-fortune/11-02-SUMMARY.md`
</output>
