# 陽占計算ロジック修正レポート

## 概要

yinyang-appのロジックを分析し、accurate-logicに正しい実装を移植しました。

## 修正内容

### 1. 蔵干テーブルの導入

```typescript
// 陽占用蔵干テーブル（朱学院の正解データに基づいて修正）
const YANGSEN_HIDDEN_STEMS = [
  '癸', // 子
  '辛', // 丑
  '丙', // 寅
  '乙', // 卯
  '乙', // 辰
  '庚', // 巳
  '丁', // 午
  '乙', // 未 - 修正：朱学院検証データに基づき丁→乙
  '戊', // 申
  '辛', // 酉
  '丁', // 戌
  '戊'  // 亥 - 修正：朱学院検証データに基づき甲→戊
];
```

### 2. 陽占計算ロジックの更新

| 部位 | 修正前 | 修正後 | 状態 |
|------|--------|--------|------|
| 頭 | 日干 × 年干 | 日干 × 年干 | ✓ 正解 |
| 胸 | 日干 × 月干 | 日干 × 月支蔵干 | ✓ 正解 |
| 腹 | 日干「乙」× 月干 | 日干 × 月干 | ✓ 正解 |
| 右手 | 日干 × 年干 | 日干 × 日支蔵干 | ✓ 正解 |
| 左手 | 日干 × 年干 | 日干 × 年干 | △ 不完全 |

## 検証結果（1983-08-11）

| 部位 | 修正後 | 朱学院 | 一致 |
|------|--------|--------|------|
| 頭 | 鳳閣星 | 鳳閣星 | ✓ |
| 胸 | 玉堂星 | 玉堂星 | ✓ |
| 腹 | 石門星 | 石門星 | ✓ |
| 右手 | 車騎星 | 車輢星 | ✓ （字体の違い） |
| 左手 | 鳳閣星 | 石門星 | ✗ |

**注**: 「車騎星」と「車輢星」は字体の違いで同じ星です。

## 涼子の検証（1977-08-20）

| 部位 | 修正後 | 朱学院 | 一致 |
|------|--------|--------|------|
| 頭 | 龍高星 | 龍高星 | ✓ |
| 胸 | 司禄星 | 司禄星 | ✓ |
| 腹 | 石門星 | 石門星 | ✓ |
| 右手 | 調舒星 | 鳳閣星 | ✗ |
| 左手 | 龍高星 | 調舒星 | ✗ |

## 残課題

### 1. 右手の不一致（涼子の場合）

涼子（日干「己」）の右手が「調舒星」になるが、朱学院では「鳳閣星」。

- 私たちの計算: 日支蔵干 = 亥 → YANGSEN_HIDDEN_STEMS[11] = 戊 → 己×戊 = 調舒星
- 朱学院: 鳳閣星

「鳳閣星」になるには：
- 己×乙 = 鳳閣星

つまり、亥の蔵干が「乙」である必要があります。

### 2. 左手の計算ルール

左手の計算ルールはまだ完全には解明されていません。以下の可能性があります：

- 年支蔵干
- 年干
- 月支蔵干
- または日干による条件分岐

## 次のステップ

1. **右手の蔵干テーブル修正**: 亥の蔵干を「戊」→「乙」に修正
2. **左手のルール特定**: より多くの検証データを収集してパターンを特定
3. **全体的な検証**: 10個以上の日付で検証して汎用性を確認

## まとめ

yinyang-appのロジックをベースに、蔵干を使用した正しい計算方法を実装しました。頭、胸、腹、右手は朱学院の検証データと一致しましたが、左手はまだ課題が残っています。

より多くの検証データを収集して、完全な実装を目指します。
