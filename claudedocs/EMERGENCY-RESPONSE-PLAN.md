# 既存キャラクター問題緊急対策

**作成日**: 2026-02-10
**ステータス**: 緊急対応中

---

## 1. 問題の深刻さ

### 1.1 発見された問題
- **日干不一致**: 全キャラクターで既存の日干データが間違い
  - 例: 佐藤 翔 → 既存: 甲, 計算: 癸
  - 例: 双子姉妹 → 既存: 辛, 計算: 己
- **陽占データ欠落**: 十大主星・十二大従星がundefined
  - 原因: birth_timeフィールドが欠落しているため
- **年齢ずれ**: 2歳の誤差（2026年基準 vs 元のデータ）

### 1.2 影響
- 既存キャラクターデータは使用不可
- accurate-logicでの再計算が必要
- 朱学院での検証前にデータ修正が必須

---

## 2. 緊急対応策

### 2.1 即時アクション
1. **時刻データの補完**: 全キャラクターにデフォルト時刻（12:00）を設定
2. **全キャラクターの再計算**: accurate-logicで正しいsanmeigakuデータを計算
3. **JSONファイル更新**: 計算結果で既存ファイルを上書き
4. **朱学院でのダブルチェック**: 検証実施

### 2.2 実施手順

#### ステップ1: 時刻補完スクリプト作成
```typescript
// 全キャラクターに birth_time: "12:00" を追加
```

#### ステップ2: 完全再計算スクリプト実行
```bash
npx tsx scripts/recalculate-all-characters.ts
```

#### ステップ3: 各エピソードファイルの更新
- EPISODES-1-24-CHARACTERS.json
- EPISODES-25-48-CHARACTERS.json
- EPISODES-49-72-CHARACTERS.json
- EPISODES-73-96-CHARACTERS.json
- EPISODES-91-120-CHARACTERS.json

#### ステップ4: 朱学院でのダブルチェック
- ランダムに10キャラクターを選択
- 朱学院で計算結果を検証
- 100%一致を確認

---

## 3. 根本原因分析

### 3.1 既存データの問題点
1. **計算ロジックの不備**: 正しい算命学ライブラリ（accurate-logic）を使用していなかった
2. **検証プロセス欠如**: 朱学院でのダブルチェックが実施されていなかった
3. **データ整合性管理不足**: 生年月日とsanmeigakuデータの一貫性管理が不十分

### 3.2 再発防止策
1. **accurate-logic統合**: 全キャラクター作成時にaccurate-logicを使用
2. **朱学院検証フロー**: 新規キャラクターは必ず朱学院でダブルチェック
3. **データ整合性テスト**: 生年月日→sanmeigakuデータの整合性を自動検証

---

## 4. 実施計画

### 4.1 優先タスク
- [ ] 時刻補完スクリプト作成・実行
- [ ] 全キャラクター再計算スクリプト作成・実行
- [ ] JSONファイル一括更新
- [ ] 朱学院検証（10サンプル）
- [ ] 検証レポート作成

### 4.2 スケジュール
- **緊急対応**: 本日中に完了
- **検証**: 明日中に完了
- **最終確認**: 週末までに完了

---

## 5. リスク管理

### 5.1 リスク
- 既存キャラクターの物語との整合性
- エピソードテーマとの適合性

### 5.2 対策
- 生年月日は変更せず、sanmeigakuデータのみ更新
- テーマとの適合性は後で別途検証

---

**作成者**: AIプロジェクトマネージャー
**最終更新**: 2026-02-10
**バージョン**: 1.0
