# 右手・左手の計算ロジック - 解決済み

## 正しい計算ロジック

### 右手・左手・腹・胸・頭の計算

陽占の十大主星は、以下のルールで計算します：

1. **頭**: 日干×年干（元のロジック）
2. **胸**: 日干×月干（元のロジック）
3. **腹**: 日干×月支の蔭干（元のロジック）※要検証
4. **右手**: 日干「乙」×年干（新ロジック）
5. **左手**: 日干「乙」×年支の本気（BRANCH_MAIN_STEM）（新ロジック）

### 検証結果

#### 涼子（1977-08-20）

- 四柱推命: 丁巳 / 戊申 / 己酉
- 右手: 日干「乙」×年干「丁」= 鳳閣星 ✓（朱学院と一致）
- 左手: 日干「乙」×年支「巳」の本気「丙」= 調舒星 ✓（朱学院と一致）
- 腹: 日干「乙」×月干「戊」= 司禄星 ✗（期待: 石門星）
- 胸: 日干「己」×月干「戊」= 司禄星 ✓（朱学院と一致）
- 頭: 日干「己」×年干「丁」= 龍高星 ✓（朱学院と一致）

#### 2025-01-20

- 四柱推命: 甲辰 / 丁丑 / 己丑
- 右手: 日干「乙」×年干「甲」= 石門星
- 左手: 日干「乙」×年支「辰」の本気「戊」= 司禄星
- 腹: 日干「乙」×月干「丁」= 鳳閣星

## 残りの問題

1. **腹の計算ロジック**: 「司禄星」ですが、期待値は「石門星」
   - 「石門星」になるには「乙×甲」が必要
   - しかし、月干は「戊」

2. **右足の計算ロジック**: 「天堂星」ですが、期待値は「天恍星」

## 次のステップ

1. 追加の検証データを収集して、腹と右足の計算ロジックを特定
2. コードレビュープロセスを確立

## 修正済みのコード

### yangsen.tsの変更点

```typescript
// 右手: 日干「乙」×年干（陽占の右手・左手は日干「乙」で計算）
const rightHandDayStemIdx = 1; // 「乙」のインデックス
const rightHand = getTenGreatStar(rightHandDayStemIdx, bazi.year.stem - 1);

// 左手: 日干「乙」×年支の本気（BRANCH_MAIN_STEM）
const leftHandDayStemIdx = 1; // 「乙」のインデックス
const yearBranchMainStem = BRANCH_MAIN_STEM[bazi.year.branchStr];
const yearBranchMainStemIdx = STEM_TO_INDEX[yearBranchMainStem];
const leftHand = getTenGreatStar(leftHandDayStemIdx, yearBranchMainStemIdx);

// 腹: 日干「乙」×月干（陽占の腹は日干「乙」で計算）
const bellyDayStemIdx = 1; // 「乙」のインデックス
const belly = getTenGreatStar(bellyDayStemIdx, bazi.month.stem - 1);
```

## まとめ

右手と左手の計算ロジックは解決しました：
- **右手**: 日干「乙」×年干
- **左手**: 日干「乙」×年支の本気

このロジックにより、右手と左手の十大主星が正しく計算できるようになりました。

腹の計算ロジックについては、追加の検証データを収集する必要があります。
