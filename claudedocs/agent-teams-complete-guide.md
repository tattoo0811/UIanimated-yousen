# Agent Teams 完全ガイド

**Claude Codeのマルチエージェント協調機能 - 設定から実践まで**

---

## 目次

1. [概要](#概要)
2. [エージェントチームとは](#エージェントチームとは)
3. [サブエージェントとの違い](#サブエージェントとの違い)
4. [適したユースケース](#適したユースケース)
5. [設定方法](#設定方法)
6. [チームの作成と起動](#チームの作成と起動)
7. [実行中の制御方法](#実行中の制御方法)
8. [ベストプラクティス](#ベストプラクティス)
9. [現在の制限事項](#現在の制限事項)
10. [今後の展望](#今後の展望)

---

## 概要

OpenClawコミュニティが先駆けて開発したマルチエージェント機能が、AnthropicによってClaude Codeにネイティブ実装されました。プラグインや回避策なしで、複数のエージェントが同じプロジェクトで並行作業し、相互に調整できるようになりました。

この機能は現在研究プレビュー段階にあり、本ガイドではインストール、設定、実践的な使用方法を網羅的に解説します。

---

## エージェントチームとは

### 従来の単一エージェントからの進化

**これまで：**
- 1人のエージェントがすべてのタスクを順次実行
- ステップ1完了 → ステップ2完了 → ステップ3完了...
- 1つのタスクずつ、直線的に処理

**Agent Teams：**
- リードエージェントがタスクを分割
- 複数のチームメイトが同時に並行作業
- 相互にメッセージを送信し、調整

### 実務的な比較

```
従来: フリーランサーがすべてを一人で実行
Agent Teams: プロジェクトマネージャーが専門チームを率い、タスクを割り振り
```

### 具体的な作業例

複数のチームメイトが同時に異なる作業を実行：

- **チームメイトA**: コードベースの調査
- **チームメイトB**: 関数のデバッグ
- **チームメイトC**: テストの作成

各メイトは独自のコンテキストウィンドウとワークスペースを持ち、直接通信して発見を共有します。

---

## サブエージェントとの違い

### サブエージェント

- セッション内で起動
- 集中的なタスクを実行し、結果をメインエージェントに報告
- シンプルで効果的、トークン消費も少ない
- **例**: アシスタントを送って回答を取得

### Agent Teams

- 各チームメイトは完全に独立したClaude Codeセッション
- 独自のコンテキストウィンドウを持つ
- リードへの報告だけでなく、直接相互通信
- 発見を共有し、互いの作業を検証
- 共有タスクリストで自己調整

### 選択の指針

**核心的な問い: 作業者同士の通信が必要か？**

| 条件 | 推奨 | 理由 |
|------|------|------|
| 通信不要 | サブエージェント | 安価、集中タスク向け |
| 協調が必要 | Agent Teams | 複雑なマルチパート作業に最適 |

**コストパフォーマンス:**

- **サブエージェント**: トークン消費が少ない、集中タスクに最適
- **Agent Teams**: コストは高いが、単一エージェントよりも複雑な作業を効率化

---

## 適したユースケース

### Agent Teamsが輝くシナリオ

#### 1. リサーチとレビュー
複数のチームメイトが問題の異なる角度を同時に調査し、結果を比較

#### 2. 新機能の構築
各チームメイトが別々のモジュールやファイルを担当

#### 3. デバッグ（特におすすめ）
単一エージェントが一つの道を進んで無駄に時間を費やすのを回避
- 複数のチームメイトが競合する仮説を並列テスト
- 最初に答えを見つけた者が勝ち、他は停止

#### 4. クロスレイヤー作業
- フロントエンド担当
- バックエンド担当
- テスト担当
各自が自分の領域を所有し、干渉を避ける

### Agent Teamsが不向きなシナリオ

#### ❌ 逐次的なタスク
ステップ2がステップ1の完了を前提とする場合、並列化のメリットなし

#### ❌ 同一ファイル編集
複数のチームメイトが同じファイルを触ると上書きのリスク

#### ❌ シンプルなタスク
調整のオーバーヘッドが、単一エージェントで迅速に処理するコストを上回る

### 判断基準

**チームを立ち上げる前の自問:**
> 作業を独立したパーツに分割できるか？

- **Yes**: Agent Teamsを活用
- **No**: 単一セッションまたはサブエージェントが適切

---

## 設定方法

### ステップ1: 実験的機能を有効化

Agent Teamsはデフォルトで無効になっているため、有効化が必要。

#### 方法A: settings.jsonで設定（推奨）

```json
{
  "env": {
    "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"
  }
}
```

#### 方法B: シェル環境変数

```bash
export CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS="1"
```

settings.jsonの方がセッション間で永続化されるため、よりクリーンです。

### ステップ2: 設定の確認

設定が完了すれば、Claude CodeはAgent Teamsコマンドを認識するようになります。

公式ドキュメント: https://code.claude.com/docs/en/agent-teams

---

## チームの作成と起動

### 特別な構文は不要

自然言語で「チームを作成」と伝えるだけでOKです。

### 良いプロンプトの例

```
CLIツールを設計しています。このツールは開発者がコードベース全体の
TODOコメントを追跡するのに役立ちます。異なる角度から探求する
エージェントチームを作成してください：
- 1人はUX担当
- 1人は技術アーキテクチャ担当
- 1人は悪役（批判的視点）担当
```

### 良いプロンプトの条件

- **詳細な役割定義**: リードが明確で独立した役割を割り当てられる
- **重複の回避**: 各メイトの役割が重複しすぎない
- **具体的な指示**: 曖昧さを減らし、フォーカスされた結果を得る

### モデルとチームサイズの指定

```
4人のチームメイトを持つチームを作成し、これらのモジュールを
並列でリファクタリングしてください。各チームメイトにはSonnetを
使用してください。
```

### 表示モード

#### In-Process Mode（デフォルト）
- すべてのチームメイトがメインターミナル内で実行
- `Shift+Up` / `Shift+Down` でサイクル

#### Split-Pane Mode
- 各チームメイトが独自のペインを持つ
- tmuxまたはiTerm2が必要
- すべての出力を同時に確認可能

---

## 実行中の制御方法

### 1. チームメイトとの直接対話

リード経由ではなく、任意のチームメイトと直接会話可能

- **In-Process Mode**: `Shift+Up` / `Shift+Down` でチームメイトを選択して入力
- **Split-Pane Mode**: ペインをクリックして通常のClaude Codeセッションのように対話

### 2. デリゲートモード

**解決する問題:** リードがチームメイトの完了を待たずに自分で作業を始める場合

**機能:** リードを調整専用にロック
- チームメイトの起動のみ
- タスクの割り当てのみ
- メッセージの送信のみ
- タスクリストの管理のみ

**有効化:** チーム実行中に `Shift+Tab`

### 3. タスクの割り当て方法

#### リードによる割り当て
リードが各タスクを特定のチームメイトに指示

#### チームメイトによる自己申告
チームメイトが現在のタスクを完了すると、共有リストから次の未割り当てタスクを自動的にピックアップ

### 4. チームメイトの終了

作業が完了したチームメイトを終了させるには：

1. リードに終了を依頼
2. リードがシャットダウンリクエストを送信
3. チームメイトが確認
4. 优雅に終了

**重要**: クリーンアップを実行する前に、すべてのチームメイトを終了させること。

---

## ベストプラクティス

### 1. 詳細な起動プロンプトを提供

チームメイトは以下を自動的にロード：
- プロジェクトコンテキスト（CLAUDE.mdから）
- MCPサーバー

**しかし:** リードの会話履歴は継承しない

**対策:** タスクに必要な特定のコンテキストを起動プロンプトに含める。アップフロントで具体的であるほど、行き来が減り、フォーカスされた結果が得られる。

### 2. 適切なタスクサイジング

| サイズすぎ | 問題 |
|-----------|------|
| 小さすぎ | 調整のオーバーヘッドがメリットを上回る |
| 大きすぎ | チェックインなしで長時間作業 → 無駄な努力のリスク増加 |

**甘いスポット:** 明確な成果物を生む自己完結単位
- 関数
- テストファイル
- レビュー

### 3. 各チームメイトを別のファイルで作業

**理由:** 複数のチームメイトが同じファイルを編集 → 上書きの頭痛

**解決:** 作業を分割し、各メイトが独自のファイルセットを所有するように

### 4. リサーチ・レビューから始める

並列実装の複雑さに入る前に、以下のタスクで並列作業の価値を体験：

- 異なる角度でPRをレビュー
- 競合する理論でバグを調査

これらのタスクは、作業の調整複雑さなしに並列作業の価値を示す

### 5. 定期的なチェックイン

長時間無人で実行 → 無駄な努力のリスク増加（特に非生産的な道に進んだチームメイト）

---

## 現在の制限事項

実験的機能のため、以下の粗削れな部分を認識しておくこと：

### 1. セッションレジュームの非互換

**問題:** `/resume` または `/rewind` 使用時、in-processチームメイトは戻ってこない

**結果:** リードがメッセージを送信しても、彼らは存在しない

**対処:** リードに新しいチームメイトを起動させる

### 2. タスクステータスのラグ

**問題:** チームメイトが作業を完了しても、タスクを完了とマークしない場合がある

**結果:** 依存タスクがブロックされる

**対処:**
- 作業が実際に完了しているか確認
- ステータスを手動更新またはリードにチームメイトを促させる

### 3. 1セッション1チーム制限

- セッションあたり1チームのみ実行可能
- チームメイトは自分のチームを起動できない
- チーム作成セッションが永続的にリード
- チームメイトの昇格やリーダーシップ移転は不可

### 4. Split-Pane Modeの制限

**対応環境:**
- tmux
- iTerm2

**非対応環境:**
- VS Code統合ターミナル
- Windows Terminal
- Ghostty

**代替:** デフォルトのin-process modeはすべての環境で動作

---

## 今後の展望

Agent Teamsは研究プレビュー段階にあり、Anthropicは積極的に開発を進めています。

### 現在の位置づけ

これはベースラインであり、天井ではありません。

### 改善の余地

以下の分野で改善が進められています：

- セッションレジューム機能
- タスク調整
- シャットダウン動作

### 将来の標準機能

これらの改善が進むにつれ、Agent Teamsはデフォルト機能として標準化されるでしょう。

### 早期導入のメリット

早期にインストールしてマッスルメモリを構築している人々は、プレビュー段階を終えてデフォルト機能になった際、深刻なアドバンテージを持つことになります。

---

## まとめ

Agent Teamsは、複雑なマルチパート作業を並列化し、単一エージェントよりも大幅な効率向上を実現する強力な機能です。適切に使用すれば、リサーチ、レビュー、新機能構築、デバッグなどのタスクで革命的な生産性向上をもたらします。

一方で、調整のオーバーヘッドとトークン消費を理解し、適切なユースケースで使用することが重要です。

本ガイドを参考に、小さなタスクから始めて、徐々に複雑なワークフローへとスケールアップすることをお勧めします。

---

**参考リソース:**
- 公式ドキュメント: https://code.claude.com/docs/en/agent-teams
- The AI Operator's Playbook: 実運用ワークフロー、ツール、実装メソッドの詳細（週次更新）
