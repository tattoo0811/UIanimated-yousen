# 算命学ロジック検証レポート

## 実行日
2026-02-10

## 参考サイト
朱学院 公式占い計算サイト: https://www.shugakuin.co.jp/fate_calculation

## 検証対象

### 1983年8月11日（男性）

#### 四柱推命（BaZi）

| 項目 | 正解値（朱学院）| 現在のロジック | 結果 |
|------|------------------|----------------|------|
| 年柱 | 辛未 | 辛未 | ✅ 一致 |
| 月柱 | 庚申 | 庚申 | ✅ 一致 |
| 日柱 | 癸亥 | 癸亥 | ✅ 一致 |

#### 十大主星（人体図）

| 部位 | 正解値（朱学院）| 現在のロジック | 結果 | 備考 |
|------|------------------|----------------|------|------|
| 頭 | 鳳閣星 | 鳳閣星 | ✅ 一致 | 日干×年干 |
| 胸 | 玉堂星 | 玉堂星 | ✅ 一致 | 日干×月支の蔵干（二十八元） |
| 腹 | 司禄星 | 車騎星 | ❌ 不一致 | 日干×月干 |
| 右手 | 車輪星 | 貫索星 | ❌ 不一致 | 日干×日支の蔵干（二十八元） |
| 左手 | 石門星 | 貫索星 | ❌ 不一致 | 日干×年支の蔵干（二十八元） |

#### 十二大従星（人体図）

| 部位 | 正解値（朱学院）| 現在のロジック | 結果 | 備考 |
|------|------------------|----------------|------|------|
| 左肩 | 天恍星（7点） | 天恍星（7点） | ✅ 一致 | 年支 |
| 左足 | 天将星（12点） | 天将星（12点） | ✅ 一致 | 月支 |
| 右足 | 天堂星（8点） | 天堂星（8点） | ✅ 一致 | 日支 |

---

### 1984年12月2日（男性）

#### 四柱推命（BaZi）

| 項目 | 正解値（朱学院）| 現在のロジック | 結果 |
|------|------------------|----------------|------|
| 年柱 | 庚午 | 甲子 | ❌ 不一致 |
| 月柱 | 乙亥 | 乙亥 | ✅ 一致 |
| 日柱 | 甲子 | 甲子 | ✅ 一致 |

#### 十大主星（人体図）

| 部位 | 正解値（朱学院）| 現在のロジック | 結果 | 備考 |
|------|------------------|----------------|------|------|
| 頭 | 禄存星 | 禄存星 | ✅ 一致 | 日干×年干 |
| 胸 | 鳳閣星 | 鳳閣星 | ✅ 一致 | 日干×月支の蔵干（二十八元） |
| 腹 | 司禄星 | 司禄星 | ✅ 一致 | 日干×月干 |
| 右手 | 牽牛星 | 調舒星 | ❌ 不一致 | 日干×日支の蔵干（二十八元） |
| 左手 | 調舒星 | 調舒星 | ✅ 一致 | 日干×年支の蔵干（二十八元） |

#### 十二大従星（人体図）

| 部位 | 正解値（朱学院）| 現在のロジック | 結果 | 備考 |
|------|------------------|----------------|------|------|
| 左肩 | 天恍星（7点） | 天極星（2点） | ❌ 不一致 | 年支 |
| 左足 | 天胡星（4点） | 天胡星（4点） | ✅ 一致 | 月支 |
| 右足 | 天極星（2点） | 天恍星（7点） | ❌ 不一致 | 日支 |

---

## 問題点の分析

### 1. 年柱の計算問題（1984年12月2日）

**現象:**
- 正解値: 庚午
- 現在のロジック: 甲子

**原因:**
lunar-javascriptライブラリが返す年柱が、立春の日付を考慮していない可能性があります。
1984年12月2日は立春（2月4日頃）を過ぎているため、まだ1984年の年柱を使用するはずですが、
ライブラリが暦年的な年（1985年）を返している可能性があります。

**確認が必要:**
- lunar-javascriptの年柱計算ロジック
- 立春前後の境界判定

### 2. 十大主星の計算問題（1983年8月11日）

**現象:**
- 腹: 司禄星（正解） vs 車騎星（現在）
- 右手: 車輪星（正解） vs 貫索星（現在）
- 左手: 石門星（正解） vs 貫索星（現在）

**原因:**
蔵干の計算に問題がある可能性があります。
- 腹（月干）: 日干（癸）× 月干（庚） → 司禄星になるはず
  - 癸（水、陰）× 庚（金、陽） → 印・陽 → 玉堂星 ではなく司禄星？
  - 五行関係: 水(4) - 金(3) + 5 = 6 % 5 = 1 （洩気）
  - 陰陽: 異なる → 1
  - インデックス: 1 * 2 + 1 = 3 → 玉堂星（土・陰） ではなく司禄星？

**十大主星のマッピング確認が必要:**
```
0: 比和・陽 = 貫索星（木・陽）
1: 比和・陰 = 石門星（木・陰）
2: 洩気・陽 = 鳳閣星（火・陽）
3: 洩気・陰 = 調舒星（火・陰）
4: 財・陽 = 禄存星（土・陽）
5: 財・陰 = 司禄星（土・陰）
6: 官・陽 = 車輪星（金・陽）
7: 官・陰 = 牽牛星（金・陰）
8: 印・陽 = 龍高星（水・陽）
9: 印・陰 = 玉堂星（水・陰）
```

癸（水・陰）× 庚（金・陽）の場合:
- 水生金（水→金） = 洩気（自分の気を失う関係）
- 水の陰、金の陽 → 異なる陰陽
- 洩気・陰 → 調舒星 になるはず

しかし正解は司禄星（土・陰）です。

これは「金生水（金→水）」＝ 印（自分を生む関係）と解釈している可能性があります。

**五行関係の方向性の問題:**
現在のロジック: `(tElem - dElem + 5) % 5`
- 対象五行 - 日干五行
- 金(3) - 水(4) + 5 = 4 % 5 = 4 （印）

正解の解釈:
- 日干（水）が対象（金）から生まれる → 印
- 印・陽 → 龍高星（水・陽）

しかし正解は司禄星（土・陰）＝ 財・陰です。

これは「金→土→水」の五行相生を考慮しているか、
あるいは別の計算ロジックを使用している可能性があります。

### 3. 二十八元（蔵干）の計算問題

**1983年8月11日:**
- 日支: 亥
- 正解の右手（日支の蔵干からの十大主星）: 車輪星
- 現在のロジック: 貫索星

亥の蔵干（二十八元）:
- 初気: 壬（水・陽）
- 中気: 甲（木・陽）
- 本気: 壬（水・陽）

癸（水・陰）× 壬（水・陽）:
- 比和・陽 → 貫索星

正解は車輪星（金・陽）＝ 官・陽です。

これは蔵干が異なるか、計算ロジックが異なる可能性があります。

### 4. 十二大従星の計算問題（1984年12月2日）

**現象:**
- 左肩: 天恍星（7点、正解） vs 天極星（2点、現在）
- 右足: 天極星（2点、正解） vs 天恍星（7点、現在）

**原因:**
年支と日支が逆になっている可能性があります。

1984年12月2日の四柱:
- 年柱: 庚午
- 日柱: 甲子

左肩（年支＝午）:
- 甲（木・陽）の建禄支: 寅（3番目）
- 午（7番目） - 寅（3番目） + 12 = 16 % 12 = 4
- 陽干なのでそのまま: 4 → 天南星（10点）

しかし正解は天恍星（7点）です。

これは十二大従星の配列が異なる可能性があります。

**十二大従星の配列確認:**
現在のロジック（constants.ts）の配列順序を確認する必要があります。

---

## 修正案

### 優先度1: 年柱の計算（立春の考慮）

**問題:**
lunar-javascriptライブラリが立春を考慮していない可能性があります。

**解決策:**
1. 立春の日付を取得
2. 生年月日が立春前の場合、前年の年柱を使用する
3. または、lunar-javascriptの内部実装を確認して修正する

```typescript
// 仮の修正案
function adjustYearForSpringBoundary(date: Date): number {
  // 立春は通常2月4日頃
  const springBeginning = new Date(date.getFullYear(), 1, 4); // 2月4日

  if (date.getMonth() === 1 && date.getDate() < 4) {
    // 2月1日〜3日の場合は前年
    return date.getFullYear() - 1;
  }

  return date.getFullYear();
}
```

### 優先度2: 十大主星の計算ロジック

**問題:**
五行関係の計算式 `(tElem - dElem + 5) % 5` が正解と一致しない。

**解決策:**
1. 五行関係のマッピング表を確認
2. 算命学の教科書通りの計算式に修正
3. すべての組み合わせ（10×10=100通り）のテストケースを作成

### 優先度3: 二十八元（蔵干）の計算

**問題:**
蔵干の選択ロジックが正解と一致しない。

**解決策:**
1. 二十八元のデータを確認
2. 節入りからの経過日数の計算を確認
3. 蔵干の選択ロジックを修正

### 優先度4: 十二大従星の計算

**問題:**
星の配列または計算式が正解と一致しない。

**解決策:**
1. 十二大従星の配列を確認
2. 建禄支の計算を確認
3. 位相の計算式を確認

---

## 次のステップ

1. ✅ 正解値の取得（完了）
2. ✅ 現在のロジックの出力を確認（完了）
3. ⏳ 問題点の特定（進行中）
4. ⏳ 修正案の実装
5. ⏳ 修正後の検証テスト

---

## 参考資料

- 正解値JSON: `claudedocs/expected_values_from_shugakuin.json`
- 現在のロジック: `src/bazi.ts`, `src/yangsen.ts`, `src/constants.ts`
- テストファイル: `tests/verification.test.ts`
