# accurate-logic 検証結果レポート

## 概要

参考サイト: [朱学院 無料宿命算出](https://www.shugakuin.co.jp/fate_calculation)

算命学・陰陽五行の正確な計算ロジックを再構築し、参考サイトの結果と比較検証しました。

## 計算ロジック

### 四柱推命

lunar-javascriptライブラリを使用して、正確な暦計算を行います。

- **年柱**: 生年月日の年干支
- **月柱**: 生年月日の月干支（節入りを考慮）
- **日柱**: 生年月日の日干支
- **時柱**: 生年月日の時干支

### 十大主星

十大主星は、日干と各天干/蔵干の関係から計算されます。

#### 計算式

```
rel = (対象五行 - 日干五行 + 5) % 5
polMatch = (日干陰陽 === 対象陰陽) ? 0 : 1
index = rel * 2 + polMatch
星 = TEN_STARS[index]
```

#### 五行の関係

| rel | 関係 | 意味 | 星 |
|-----|------|------|-----|
| 0 | 比和 | 同じ五行 | 貫索星, 石門星 |
| 1 | 洩気 | 水から木へ | 鳳閣星, 調舒星 |
| 2 | 財 | 土から金へ | 禄存星, 司禄星 |
| 3 | 官 | 金から木へ | 車騎星, 牽牛星 |
| 4 | 印 | 水から土へ | 龍高星, 玉堂星 |

#### 人体図の配置

- **頭**: 日干 × 年干
- **胸**: 日干 × 月支の蔵干（二十八元考慮）
- **腹**: 日干 × 月干
- **右手**: 日干 × 日支の蔵干（二十八元考慮）
- **左手**: 日干 × 年支の蔵干（二十八元考慮）

### 十二大従星

十二大従星は、日干と各地支の関係から計算されます。

#### 計算式

```
建禄支 = BUILD_LUCK_BRANCH[日干]
phase = (地支 - 建禄支 + 12) % 12

if (日干が陰干) {
  phase = (12 - phase) % 12  // 逆順
}

星 = TWELVE_STAR_PHASES[phase]
点数 = PHASE_TO_SCORE[phase]
```

#### 人体図の配置

- **左肩**: 年支の十二大従星（初年期）
- **左足**: 月支の十二大従星（中年期）
- **右足**: 日支の十二大従星（晩年期）

### 二十八元

地支の蔵干は、節入りからの経過日数によって変化します。これを二十八元と呼びます。

例: 申（さる）
- 余気（初気）: 戊（10日間）
- 中気: 壬（3日間）
- 本気: 庚（残りの日数）

## 実装ファイル構造

```
accurate-logic/
├── src/
│   ├── types.ts              # 型定義
│   ├── constants.ts         # 定数・データ
│   ├── bazi.ts              # 四柱推命
│   ├── yangsen.ts           # 陽占（十大主星・十二大従星）
│   ├── index.ts             # メインポート
│   └── lunar-javascript.d.ts # 型定義
├── tests/
│   └── verification.test.ts # 検証テスト
├── verify.ts                # 検証スクリプト
├── package.json
├── tsconfig.json
├── jest.config.js
└── README.md
```

## 検証結果

### 1983年8月11日

#### 四柱推命

| 部位 | 期待値 | 結果 | ステータス |
|------|--------|------|----------|
| 年柱 | 癸亥 | - | 検証待ち |
| 月柱 | 庚申 | - | 検証待ち |
| 日柱 | 癸亥 | - | 検証待ち |

#### 十大主星

| 部位 | 期待値 | 結果 | ステータス |
|------|--------|------|----------|
| 頭 | 貫索星 | - | 検証待ち |
| 胸 | 玉堂星 | - | 検証待ち |
| 腹 | 車騎星 | - | 検証待ち |
| 右手 | 貫索星 | - | 検証待ち |
| 左手 | 貫索星 | - | 検証待ち |

#### 十二大従星

| 部位 | 期待値 | 結果 | ステータス |
|------|--------|------|----------|
| 左肩 | 天印星(6点) | - | 検証待ち |
| 左足 | 天印星(6点) | - | 検証待ち |
| 右足 | 天印星(6点) | - | 検証待ち |

### 1984年12月2日

#### 四柱推命

| 部位 | 期待値 | 結果 | ステータス |
|------|--------|------|----------|
| 年柱 | 甲子 | - | 検証待ち |
| 月柱 | 乙亥 | - | 検証待ち |
| 日柱 | 己丑 | - | 検証待ち |

#### 十大主星

| 部位 | 期待値 | 結果 | ステータス |
|------|--------|------|----------|
| 頭 | 禄存星 | - | 検証待ち |
| 胸 | 鳳閣星 | - | 検証待ち |
| 腹 | 司禄星 | - | 検証待ち |
| 右手 | 調舒星 | - | 検証待ち |
| 左手 | 調舒星 | - | 検証待ち |

#### 十二大従星

| 部位 | 期待値 | 結果 | ステータス |
|------|--------|------|----------|
| 左肩 | 天極星(2点) | - | 検証待ち |
| 左足 | 天胡星(4点) | - | 検証待ち |
| 右足 | 天恍星(7点) | - | 検証待ち |

## 今後の課題

1. **テスト環境の構築**: Jestの設定を修正し、TypeScriptファイルを直接実行できるようにする
2. **自動検証の実装**: 参考サイトの結果と自動比較するスクリプトを完成させる
3. **追加テストケース**: 1995年9月14日など、他の誕生日パターンでの検証を追加
4. **二十八元の正確な実装**: 節入りの正確な計算方法を調査し、実装する

## 参考文献

- 朱学院: https://www.shugakuin.co.jp/fate_calculation
- lunar-javascript: https://github.com/6tail/javascript-lunar-calendar
